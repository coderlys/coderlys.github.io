<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node 学习之路 | 前端学习笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./images/favicon.ico">
    <meta name="description" content="前端学习笔记">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="./assets/css/0.styles.7b00b7c5.css" as="style"><link rel="preload" href="./assets/js/app.f65de421.js" as="script"><link rel="preload" href="./assets/js/3.4298b55b.js" as="script"><link rel="preload" href="./assets/js/1.610d1c6f.js" as="script"><link rel="preload" href="./assets/js/12.36b93efc.js" as="script"><link rel="prefetch" href="./assets/js/10.68fa8d98.js"><link rel="prefetch" href="./assets/js/11.edbb6342.js"><link rel="prefetch" href="./assets/js/13.6e2906c6.js"><link rel="prefetch" href="./assets/js/14.6dae06b6.js"><link rel="prefetch" href="./assets/js/15.c01776c4.js"><link rel="prefetch" href="./assets/js/16.acb17c0b.js"><link rel="prefetch" href="./assets/js/17.9b7afedb.js"><link rel="prefetch" href="./assets/js/18.43098341.js"><link rel="prefetch" href="./assets/js/19.3b79b3ec.js"><link rel="prefetch" href="./assets/js/20.5a65f603.js"><link rel="prefetch" href="./assets/js/21.d530a75c.js"><link rel="prefetch" href="./assets/js/22.dbe6c390.js"><link rel="prefetch" href="./assets/js/23.a44d0614.js"><link rel="prefetch" href="./assets/js/24.3c4e2cec.js"><link rel="prefetch" href="./assets/js/25.7a4710aa.js"><link rel="prefetch" href="./assets/js/26.8a96e656.js"><link rel="prefetch" href="./assets/js/27.e110a717.js"><link rel="prefetch" href="./assets/js/28.99a0e3e5.js"><link rel="prefetch" href="./assets/js/29.0f4f8795.js"><link rel="prefetch" href="./assets/js/30.b949e393.js"><link rel="prefetch" href="./assets/js/31.d2e67170.js"><link rel="prefetch" href="./assets/js/32.a4dac096.js"><link rel="prefetch" href="./assets/js/4.708dbd98.js"><link rel="prefetch" href="./assets/js/5.3300b2bd.js"><link rel="prefetch" href="./assets/js/6.5ddc16d2.js"><link rel="prefetch" href="./assets/js/7.70ac515b.js"><link rel="prefetch" href="./assets/js/8.37e304ac.js"><link rel="prefetch" href="./assets/js/9.f06eeb47.js">
    <link rel="stylesheet" href="./assets/css/0.styles.7b00b7c5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>前端学习笔记</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>前端学习笔记</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><img src="./images/avatar.jpg" alt="前端学习笔记" class="logo"> <span class="site-name">前端学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      前端笔记
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/foreEnd/HTML_CSS/" class="nav-link"><i class="iconfont reco-tag"></i>
  HTML_CSS
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./tag/JS/" class="nav-link"><i class="iconfont reco-tag"></i>
  JS
</a></li><li class="dropdown-subitem"><a href="/./blogs/foreEnd/JQ/" class="nav-link"><i class="iconfont reco-tag"></i>
  JQ
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/foreEnd/VUE/2/" class="nav-link"><i class="iconfont reco-tag"></i>
  VUE2
</a></li><li class="dropdown-subitem"><a href="/./tag/vue3/" class="nav-link"><i class="iconfont reco-tag"></i>
  VUE3
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/foreEnd/Git/" class="nav-link"><i class="iconfont reco-tag"></i>
  Git
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/foreEnd/UI/ElementUI/" class="nav-link"><i class="iconfont reco-tag"></i>
  ElementUI
</a></li><li class="dropdown-subitem"><a href="/./blogs/foreEnd/UI/Vant/" class="nav-link"><i class="iconfont reco-tag"></i>
  Vant
</a></li><li class="dropdown-subitem"><a href="/./blogs/foreEnd/UI/Bootstrap/" class="nav-link"><i class="iconfont reco-tag"></i>
  Bootstrap
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      后端笔记
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/backEnd/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont reco-tag"></i>
  Node
</a></li><li class="dropdown-subitem"><a href="/./blogs/backEnd/node/koa/" class="nav-link"><i class="iconfont reco-tag"></i>
  Koa
</a></li><li class="dropdown-subitem"><a href="/./blogs/backEnd/node/express/" class="nav-link"><i class="iconfont reco-tag"></i>
  EXpress
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/backEnd/database/mysql/" class="nav-link"><i class="iconfont reco-tag"></i>
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/./timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>19</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>12</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      前端笔记
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/foreEnd/HTML_CSS/" class="nav-link"><i class="iconfont reco-tag"></i>
  HTML_CSS
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./tag/JS/" class="nav-link"><i class="iconfont reco-tag"></i>
  JS
</a></li><li class="dropdown-subitem"><a href="/./blogs/foreEnd/JQ/" class="nav-link"><i class="iconfont reco-tag"></i>
  JQ
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/foreEnd/VUE/2/" class="nav-link"><i class="iconfont reco-tag"></i>
  VUE2
</a></li><li class="dropdown-subitem"><a href="/./tag/vue3/" class="nav-link"><i class="iconfont reco-tag"></i>
  VUE3
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/foreEnd/Git/" class="nav-link"><i class="iconfont reco-tag"></i>
  Git
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/foreEnd/UI/ElementUI/" class="nav-link"><i class="iconfont reco-tag"></i>
  ElementUI
</a></li><li class="dropdown-subitem"><a href="/./blogs/foreEnd/UI/Vant/" class="nav-link"><i class="iconfont reco-tag"></i>
  Vant
</a></li><li class="dropdown-subitem"><a href="/./blogs/foreEnd/UI/Bootstrap/" class="nav-link"><i class="iconfont reco-tag"></i>
  Bootstrap
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      后端笔记
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/backEnd/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont reco-tag"></i>
  Node
</a></li><li class="dropdown-subitem"><a href="/./blogs/backEnd/node/koa/" class="nav-link"><i class="iconfont reco-tag"></i>
  Koa
</a></li><li class="dropdown-subitem"><a href="/./blogs/backEnd/node/express/" class="nav-link"><i class="iconfont reco-tag"></i>
  EXpress
</a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./blogs/backEnd/database/mysql/" class="nav-link"><i class="iconfont reco-tag"></i>
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/./timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>node 学习之路</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">node 学习之路</h1> <div data-v-f875f3fc><!----> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>3/17/2021</span></i> <!----> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>node</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="一-邂逅node-js"><a href="#一-邂逅node-js" class="header-anchor">#</a> 一：邂逅Node.js</h2> <p>Node.js是在2009年诞生的，Node.js是一个基于V8 Javascript引擎的JavaScript运行环境，但是不仅仅只有V8引擎。</p> <h3 id="_1-1-javascript引擎"><a href="#_1-1-javascript引擎" class="header-anchor">#</a> 1.1：JavaScript引擎</h3> <p><strong>为什么需要JavaScript引擎呢？</strong></p> <ul><li>事实上我们编写的JavaScript无论你交给浏览器或者Node执行，最后都是需要被CPU执行的；</li> <li>但是CPU只认识自己的指令集，实际上是机器语言，才能被CPU所执行；</li> <li>所以我们需要JavaScript引擎帮助我们将JavaScript代码翻译成CPU指令来执行；</li></ul> <p><strong>比较常见的JavaScript引擎有哪些呢？</strong></p> <ul><li>SpiderMonkey：第一款JavaScript引擎，由Brendan Eich开发（也就是JavaScript作者）；</li> <li>Chakra：微软开发，用于IT浏览器；</li> <li>JavaScriptCore：WebKit中的JavaScript引擎，Apple公司开发；</li> <li>V8：Google开发的强大JavaScript引擎，也帮助Chrome从众多浏览器中脱颖而出；</li></ul> <h3 id="_1-2-v8引擎"><a href="#_1-2-v8引擎" class="header-anchor">#</a> 1.2：V8引擎</h3> <p><strong>V8引擎的定义</strong></p> <ul><li>V8是用C ++编写的Google开源高性能JavaScript和WebAssembly引擎，它用于Chrome和Node.js等。</li> <li>它实现ECMAScript和WebAssembly，并在Windows 7或更高版本，macOS 10.12+和使用x64，IA-32，
ARM或MIPS处理器的Linux系统上运行。</li> <li>V8可以独立运行，也可以嵌入到任何C ++应用程序中。</li></ul> <h3 id="_1-3-浏览器和node-js架构区别"><a href="#_1-3-浏览器和node-js架构区别" class="header-anchor">#</a> 1.3：浏览器和Node.js架构区别</h3> <p><strong>简单理解规划出Node.js和浏览器的差异</strong></p> <p><img src="/images/node/image-20210719133449430.png" alt="image-20210719133449430"></p> <h3 id="_1-4-node的安装"><a href="#_1-4-node的安装" class="header-anchor">#</a> 1.4：Node的安装</h3> <ul><li><p>Node.js是在2009年诞生的，目前最新的版本是分别是LTS 14.17.3以及Current 16.5.0：</p> <ul><li>LTS版本：相对稳定一些，推荐线上环境使用该版本；</li> <li>Current版本：最新的Node版本，包含很多新特性；</li></ul></li> <li><p>这些我们选择什么版本呢？</p> <ul><li>如果你是学习使用，可以选择current版本；</li> <li>如果你是公司开发，建议选择LTS版本；</li></ul></li></ul> <h3 id="_1-5-javascript代码执行"><a href="#_1-5-javascript代码执行" class="header-anchor">#</a> 1.5：JavaScript代码执行</h3> <p>如果我们编写一个js文件，里面存放JavaScript代码，如何来执行它呢？</p> <ul><li><p>目前我们知道有两种方式可以执行：</p> <ul><li>将代码交给浏览器执行；</li> <li>将代码载入到node环境中执行；</li></ul></li> <li><p>如果我们希望把js文件交给node执行：</p> <ul><li>首先电脑上需要安装Node.js环境，安装过程中会自动配置环境变量；</li> <li>可以通过终端命令node js文件的方式来载入和执行对应的js文件，例如 node index.js。</li></ul></li></ul> <h3 id="_1-6-node程序传递参数"><a href="#_1-6-node程序传递参数" class="header-anchor">#</a> 1.6：Node程序传递参数</h3> <ul><li><p>正常情况下执行一个node程序，直接跟上我们对应的文件即可：</p> <p><font color="orange">node index.js</font></p></li> <li><p>但是，在某些情况下执行node程序的过程中，我们可能希望给node传递一些参数：</p> <p><font color="orange">node index.js env=development coderwhy</font></p></li> <li><p>如果我们这样来使用程序，就意味着我们需要在程序中获取到传递的参数：</p> <ul><li>获取参数其实是在<font color="red">process</font>的内置对象中的；</li> <li>如果我们直接打印这个内置对象，它里面包含特别的信息</li></ul></li> <li><p>我们先找到其中的<font color="orange">argv</font>属性</p> <ul><li>发现它是一个数组，里面包含了我们需要的参数；</li></ul></li></ul> <p><img src="/images/node/image-20210719142917788.png" alt="image-20210719142917788"></p> <h3 id="_1-7-为什么叫argv"><a href="#_1-7-为什么叫argv" class="header-anchor">#</a> 1.7：为什么叫argv</h3> <ul><li>在C/C++程序中的main函数中，实际上可以获取到两个参数：
<ul><li>argc：argument counter的缩写，传递参数的个数；</li> <li>argv：argument vector的缩写，传入的具体参数。
<ul><li>vector翻译过来是矢量的意思，在程序中表示的是一种数据结构。</li> <li>在C++、Java中都有这种数据结构，是一种数组结构；</li> <li>在JavaScript中也是一个数组，里面存储一些参数信息；</li></ul></li></ul></li></ul> <h3 id="_1-8-node的输出"><a href="#_1-8-node的输出" class="header-anchor">#</a> 1.8：Node的输出</h3> <ul><li><font color="orange">console.log</font> <ul><li>最常用的输入内容的方式：console.log</li></ul></li> <li><font color="orange">console.clear</font> <ul><li>清空控制台：console.clear</li></ul></li> <li><font color="orange">console.trace</font> <ul><li>打印函数的调用栈：console.trace</li></ul></li></ul> <h3 id="_1-9-特殊的全局对象"><a href="#_1-9-特殊的全局对象" class="header-anchor">#</a> 1.9：特殊的全局对象</h3> <ul><li>为什么我称之为特殊的全局对象呢？
<ul><li>这些全局对象可以在模块中任意使用，但是在命令行交互中是不可以使用的；</li> <li>包括：__dirname、__filename、exports、module、require()</li></ul></li> <li><font color="orange">__dirname</font>：获取当前文件所在的路径：
<ul><li>注意：不包括后面的文件名</li></ul></li> <li><font color="orange">__filename</font>：获取当前文件所在的路径和文件名称：
<ul><li>注意：包括后面的文件名称</li></ul></li></ul> <p><img src="/images/node/image-20210719144336086.png" alt="image-20210719144336086"></p> <h3 id="_2-0-global对象"><a href="#_2-0-global对象" class="header-anchor">#</a> 2.0：global对象</h3> <p>global是一个全局对象，事实上前端我们提到的process、console、setTimeout等都有被放到global中：</p> <h3 id="_2-1-global和window区别"><a href="#_2-1-global和window区别" class="header-anchor">#</a> 2.1：global和window区别</h3> <ul><li><p>在浏览器中，全局变量都是在window上的，比如有document、setInterval、setTimeout、alert、console等等</p></li> <li><p>在Node中，我们也有一个global属性，并且看起来它里面有很多其他对象。</p></li> <li><p>但是在浏览器中执行的JavaScript代码，如果我们在顶级范围内通过var定义的一个属性，默认会被添加到window</p> <p>对象上：<img src="/images/node/image-20210719145320478.png" alt="image-20210719145320478"></p></li> <li><p>但是在node中，我们通过var定义一个变量，它只是在当前模块中有一个变量，不会放到全局中：</p></li> <li><p>全局中：<img src="/images/node/image-20210719145505657.png" alt="image-20210719145505657"></p></li></ul> <h3 id="_2-2-process简介"><a href="#_2-2-process简介" class="header-anchor">#</a> 2.2：process简介</h3> <p><font color="orange">process</font>对象是Node的一个<font color="orange">全局对象</font>，提供<font color="orange">当前Node进程的信息</font>。它可以在<font color="orange">脚本的任意位置使用</font>，<font color="orange">不必通过require命令加载</font>。该对象部署了<font color="orange">EventEmitter</font>接口。</p> <p><font color="orange">process.env</font> 属性<font color="orange">返回一个对象</font>，包含了当前Shell的所有<font color="orange">环境变量</font>。
通常的做法是，新建一个环境变量NODE_ENV，用它确定当前所处的开发阶段，生产阶段设为production，开发阶段设为develop或staging，然后在脚本中读取process.env.NODE_ENV即可</p> <h2 id="二-javascript模块化"><a href="#二-javascript模块化" class="header-anchor">#</a> 二：JavaScript模块化</h2> <h3 id="_1-1-什么是模块化"><a href="#_1-1-什么是模块化" class="header-anchor">#</a> 1.1：什么是模块化？</h3> <ul><li><strong>那么，到底什么是模块化开发呢？</strong> <ul><li>事实上模块化开发最终的目的是将程序划分成<font color="cornflowerblue">一个个小的结构</font>；</li> <li>这个结构中编写属于<font color="cornflowerblue">自己的逻辑代码</font>，有<font color="cornflowerblue">自己的作用</font>域，不会影响到其他的结构；</li> <li>这个结构可以将自己希望暴露的<font color="cornflowerblue">变量</font>、<font color="cornflowerblue">函数</font>、<font color="cornflowerblue">对象等导出</font>给其结构使用；</li> <li>也可以通过某种方式，导入另外结构中的<font color="cornflowerblue">变量、函数、对象</font>等；</li></ul></li> <li>上面说提到的<font color="cornflowerblue">结构</font>，就是<font color="cornflowerblue">模块</font>；按照这种结构划分开发程序的过程，就是<font color="cornflowerblue">模块化开发</font>的过程；</li></ul> <h3 id="_1-2-没有模块化带来的问题"><a href="#_1-2-没有模块化带来的问题" class="header-anchor">#</a> <strong>1.2：没有模块化带来的问题</strong></h3> <p><strong>早期没有模块化带来了很多的问题：比如命名冲突的问题</strong></p> <ul><li><p><strong>当然，我们有办法可以解决上面的问题：立即函数调用表达式（IIFE）</strong></p> <ul><li>IIFE (Immediately Invoked Function Expression)</li></ul></li> <li><p>但是，我们其实带来了新的问题：</p> <ol><li>第一，我必须记得<font color="cornflowerblue">每一个模块中返回对象的命名</font>，才能在其他模块使用过程中正确的使用；</li> <li>第二，代码写起来<font color="cornflowerblue">混乱不堪</font>，每个文件中的代码都需要<font color="cornflowerblue">包裹在一个匿名函数中来编写</font>；</li> <li>第三，在<font color="cornflowerblue">没有合适的规范</font>情况下，每个人、每个公司都可能会任意命名、甚至出现模块名称相同的情况；</li></ol></li></ul> <p><strong>这个规范中应该包括核心功能：模块本身可以导出暴露的属性，模块又可以导入自己需要的属性；</strong></p> <h3 id="_1-3-commonjs和node"><a href="#_1-3-commonjs和node" class="header-anchor">#</a> 1.3：CommonJS和Node</h3> <ul><li><p>我们需要知道CommonJS是<font color="cornflowerblue">一个规范</font>，最初提出来是在浏览器以外的地方使用，并且当时被命名为<font color="cornflowerblue">ServerJS</font>，后来为了
体现它的广泛性，修改为<font color="cornflowerblue">CommonJS</font>，平时我们也会简称为<font color="cornflowerblue">CJS</font>。</p> <ul><li>Node是CommonJS在服务器端一个具有代表性的实现；</li> <li>p Browserify是CommonJS在浏览器中的一种实现；</li> <li>p webpack打包工具具备对CommonJS的支持和转换；</li></ul></li> <li><p>所以，Node中对<font color="cornflowerblue">CommonJS进行了支持和实现</font>，让我们在开发node的过程中可以方便的进行模块化开发：</p> <ul><li>在Node中<font color="cornflowerblue">每一个js文件都是一个单独的模块</font>；</li> <li>这个模块中包括<font color="cornflowerblue">CommonJS规范的核心变量</font>：exports、module.exports、require；</li> <li>我们可以使用这些变量来方便的进行<font color="cornflowerblue">模块化开发</font>；</li></ul></li></ul> <h3 id="_1-4-exports导出"><a href="#_1-4-exports导出" class="header-anchor">#</a> 1.4：exports导出</h3> <p>注意：exports是一个对象，我们可以在这个对象中添加很多属性，添加的属性会导出</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// bar.js文件中</span>
<span class="token keyword">let</span> name<span class="token operator">=</span><span class="token string">&quot;lys&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> age<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> height<span class="token operator">=</span><span class="token string">&quot;182&quot;</span>

exports<span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>age<span class="token operator">=</span>age<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>height<span class="token operator">=</span>height
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js文件中</span>
<span class="token keyword">const</span> bar <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./bar.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// lys</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>并且将这个exports对象赋值给了bar变量；bar变量就是exports对象了；</strong></p> <h3 id="_1-5-module-exports导出"><a href="#_1-5-module-exports导出" class="header-anchor">#</a> 1.5：module.exports导出</h3> <p><strong>导出东西的时候，又是通过module.exports导出的</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// user.js 文件</span>
<span class="token keyword">let</span> app<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;lys&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">22</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">&quot;您好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>app<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> app<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./user.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// lys</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 22</span>
app<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token string">&quot;ZhangSan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ZhangSan您好</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-6-module-exports和exports的关系和区别"><a href="#_1-6-module-exports和exports的关系和区别" class="header-anchor">#</a> 1.6：module.exports和exports的关系和区别</h3> <ul><li><strong>我们追根溯源，通过维基百科中对CommonJS规范的解析：</strong> <ul><li>CommonJS中是没有module.exports的概念的；</li> <li>但是为了实现模块的导出，Node中使用的是Module的类，每一个模块都是Module的一个实例，也就是
module；</li> <li>所以在Node中真正用于导出的其实根本不是exports，而是module.exports；</li> <li>因为module才是导出的真正实现者；</li></ul></li> <li><strong>但是，为什么exports也可以导出呢？</strong> <ul><li>这是因为module对象的exports属性是exports对象的一个引用；</li> <li>也就是说 module.exports = exports = user中的app；</li></ul></li></ul> <h3 id="_1-7-require导入"><a href="#_1-7-require导入" class="header-anchor">#</a> 1.7：require导入</h3> <ul><li>require是一个函数，可以帮助我们引入一个文件（模块）中导入的对象。</li> <li><strong>我总结比较常见的查找规则</strong>：导入格式如下：<font color="orange">require(X)</font>
情况一：<font color="cornflowerblue">X是一个核心模块，比如path、http</font>
直接返回核心模块，并且停止查找</li></ul> <h4 id="_1-7-1-导入的顺序细节"><a href="#_1-7-1-导入的顺序细节" class="header-anchor">#</a> 1.7.1：导入的顺序细节</h4> <p><strong>X是以 ./ 或 ../ 或 /（根目录）开头的</strong></p> <ul><li><p>第一步：将X当做一个文件在对应的目录下查找；</p> <ul><li>1.如果有后缀名，按照后缀名的格式查找对应的文件</li> <li>2.如果没有后缀名，会按照如下顺序：
<ul><li>1&gt; 直接查找文件X</li> <li>2&gt; 查找X.js文件</li> <li>3&gt; 查找X.json文件</li> <li>4&gt; 查找X.node文件</li></ul></li></ul></li> <li><p>第二步：没有找到对应的文件，将X作为一个目录</p> <ul><li>查找目录下面的index文件
<ul><li>1&gt; 查找X/index.js文件</li> <li>2&gt; 查找X/index.json文件</li> <li>3&gt; 查找X/index.node文件</li></ul></li></ul></li> <li><p>如果没有找到，那么报错：not found</p></li></ul> <h3 id="_1-8-认识并使用-es-module"><a href="#_1-8-认识并使用-es-module" class="header-anchor">#</a> 1.8：认识并使用 ES Module</h3> <p>JavaScript没有模块化一直是它的痛点，然后到ES6出现了ES Module模块化，推出自己的模块化系统时，大家也是兴奋异常。</p> <ul><li>ES Module模块采用export和import关键字来实现模块化：
<ul><li>export负责将模块内的内容导出；</li> <li>import负责从其他模块导入内容；</li> <li>采用ES Module将自动采用严格模式：use strict</li></ul></li></ul> <p><strong>ES Module 使用的结构</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./index.js&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>   <span class="token comment">//index.html 页面</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// foo.js 页面</span>
<span class="token keyword">let</span> app<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;lys&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">&quot;22&quot;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token string">&quot;您好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span><span class="token punctuation">{</span>
    app
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js页面</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>app<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./modules/foo.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  lys</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  22</span>
app<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token string">&quot;lys&quot;</span><span class="token punctuation">)</span> <span class="token comment">//  lys 您好</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>注意：<font color="cornflowerblue">本地测试 — 如果你通过本地加载Html 文件 (比如一个 file:// 路径的文件), 你将会遇到 CORS 错误，因为Javascript 模块安全性需要。</font><font color="orange">需要通过一个服务器来测试</font></p> <h4 id="_1-8-1-export-导出"><a href="#_1-8-1-export-导出" class="header-anchor">#</a> 1.8.1：export 导出</h4> <p>​	export关键字将一个模块中的变量、函数、类等导出；</p> <p><strong>我们希望将其他中内容全部导出，它可以有如下的方式：</strong></p> <p><strong>方式一</strong>：在语句声明的前面直接加上export关键字</p> <p><strong>方式二</strong>：将所有需要导出的标识符，放到export后面的 {}中 p</p> <ul><li>注意：这里的 {}里面不是ES6的对象字面量的增强写法，{}也不是表示一个对象的；</li> <li>所以： export {name: name}，是错误的写法；</li></ul> <p><strong>方式三</strong>：导出时给标识符起一个别名</p> <h4 id="_18-2-export-default-用法"><a href="#_18-2-export-default-用法" class="header-anchor">#</a> 18.2：export default 用法</h4> <p>​	还有一种导出叫做默认导出（default export）</p> <ul><li>导出export default 时可以不需要指定名字；</li> <li>在导入时不需要使用 {}，并且可以自己来指定名字；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// foo.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;29&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//index.js</span>
<span class="token keyword">import</span> getDay <span class="token keyword">from</span> <span class="token string">&quot;./modules/foo.js&quot;</span><span class="token punctuation">;</span>
<span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 29</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><font color="cornflowerblue">注意：在一个模块中，只能有一个默认导出（export default ）；</font></p> <h4 id="_1-8-3-import-导入"><a href="#_1-8-3-import-导入" class="header-anchor">#</a> 1.8.3：import 导入</h4> <p>​	import关键字负责从另外一个模块导入内容</p> <p><strong>导入内容的方式也有多种</strong></p> <ul><li><p>方式一：import {标识符列表} from '模块'。</p> <ul><li>注意：这里的 { } 也不是一个对象，里面只是存放导入的标识符列表内容。</li></ul></li> <li><p>方式二：导入时给标识符起别名。</p></li> <li><p>方式三：通过 * 将模块功能放到一个模块功能对象。</p></li></ul> <h4 id="_1-8-4-import函数"><a href="#_1-8-4-import函数" class="header-anchor">#</a> 1.8.4：import函数</h4> <p><strong>通过import加载一个模块，是不可以在其放到逻辑代码中的，比如：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span>app<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./modules/foo.js&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Uncaught SyntaxError: Unexpected token {   已经报错</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>为什么会出现这个情况呢？</p> <ul><li>这是因为ES Module在被JS引擎解析时，就必须知道它的依赖关系；</li> <li>由于这个时候js代码没有任何的运行，所以无法在进行类似于if判断中根据代码的执行情况；</li></ul></li> <li><p>但是某些情况下，我们确确实实希望动态的来通过import加载模块；</p> <ul><li>这个时候我们需要使用 import() 函数来动态加载；</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// foo.js</span>
<span class="token keyword">let</span> app<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;lys&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span><span class="token punctuation">{</span>
	app
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">let</span> flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./modules/foo.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>app<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="三-node常用内置模块"><a href="#三-node常用内置模块" class="header-anchor">#</a> 三：Node常用内置模块</h2> <h3 id="_1-1-内置模块-path"><a href="#_1-1-内置模块-path" class="header-anchor">#</a> 1.1：内置模块 path</h3> <ul><li>path模块用于对路径和文件进行处理，提供了很多好用的方法。</li> <li>并且我们知道在Mac OS、Linux和window上的路径时不一样的
<ul><li>window上会使用 \或者 \ 来作为文件路径的分隔符，当然目前也支持 /；</li> <li>在Mac OS、Linux的Unix操作系统上使用 / 来作为文件路径的分隔符；</li></ul></li> <li>那么如果我们在window上使用 \ 来作为分隔符开发了一个应用程序，要部署到Linux上面应该怎么办呢？</li></ul> <h4 id="_1-1-1-拼接-resolve"><a href="#_1-1-1-拼接-resolve" class="header-anchor">#</a> 1.1.1：拼接 resolve</h4> <ul><li><strong>路径的拼接</strong> <ul><li>如果我们希望将多个路径进行拼接，但是不同的操作系统可能使用的是不同的分隔符；</li> <li>这个时候我们可以使用path.join函数；</li> <li>可以接受多个参数，依次表示所要进入的路径，直到将最后一个参数转为绝对路径。</li> <li>参数中的__dirname  ： 获得当前执行文件所在目录的完整目录名</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> basePath<span class="token operator">=</span><span class="token string">&quot;/user/lys&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fileName<span class="token operator">=</span><span class="token string">&quot;abc.text&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>basePath<span class="token punctuation">,</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//  \user\lys\abc.text</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_1-1-2-拼接-join"><a href="#_1-1-2-拼接-join" class="header-anchor">#</a> 1.1.2：拼接  join</h4> <ul><li><strong>路径的拼接</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> basePath<span class="token operator">=</span><span class="token string">&quot;/user/lys&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fileName<span class="token operator">=</span><span class="token string">&quot;/abc.text&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath2<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>basePath<span class="token punctuation">,</span>fileName<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  \user\lys\abc.text</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="resolve-和-join的区别"><a href="#resolve-和-join的区别" class="header-anchor">#</a> <strong>resolve 和 join的区别</strong></h5> <ul><li>join是把各个path片段连接在一起</li> <li>resolve把‘／'当成根目录
<ul><li>若字符以 / 开头，不会拼接到前面的路径；</li> <li>若以 ../ 开头，拼接前面的路径，但是不含前面一节的最后一层路径；</li> <li>若以 ./ 开头 或者没有符号 则拼接前面路径；</li></ul></li></ul> <h4 id="_1-1-3-获取文件夹-dirname"><a href="#_1-1-3-获取文件夹-dirname" class="header-anchor">#</a> 1.1.3：获取文件夹 dirname</h4> <p><strong>获取文件的父文件夹</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> filePath<span class="token operator">=</span><span class="token string">&quot;./user/lys/abc.txt&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> dirName<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dirName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  ./user/lys</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_1-1-4-获取文件名-basename"><a href="#_1-1-4-获取文件名-basename" class="header-anchor">#</a> 1.1.4：获取文件名 basename</h4> <p><strong>获取文件名</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath<span class="token operator">=</span><span class="token string">&quot;./user/lys/abc.txt&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> baseName<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baseName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// abc.txt</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_1-1-5-获取扩展名-extname"><a href="#_1-1-5-获取扩展名-extname" class="header-anchor">#</a> 1.1.5：获取扩展名 extname</h4> <p><strong>获取文件扩展名</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath<span class="token operator">=</span><span class="token string">&quot;./user/lys/abc.txt&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> extName<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>extName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .txt</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-2-内置模块-fs"><a href="#_1-2-内置模块-fs" class="header-anchor">#</a> 1.2：内置模块 fs</h3> <p><strong>fs是File System的缩写，表示文件系统。</strong></p> <ul><li><p>对于任何一个为服务器端服务的语言或者框架通常都会有自己的文件系统：</p> <ul><li>因为<font color="cornflowerblue">服务器需要将各种数据、文件等放置到不同</font>的地方；</li> <li>比如用户数据可能大多数是放到数据库中的（后面我们也会学习）；</li> <li>比如某些配置文件或者用户资源（图片、音视频）都是以文件的形式存在于操作系统上的；</li></ul></li> <li><p>Node也有自己的文件系统操作模块，就是fs：</p> <ul><li>借助于Node帮我们封装的文件系统，我们<font color="cornflowerblue">可以在任何的操作系统</font>（window、Mac OS、Linux）上面直接去
操作文件；</li> <li>这也是Node可以开发服务器的一大原因，也是它可以成为前端自动化脚本等热门工具的原因</li></ul></li></ul> <p><strong>fs的API介绍</strong></p> <p>Node文件系统的API非常的多：</p> <ul><li>但是这些API大多数都提供三种操作方式：
<ul><li>方式一：<font color="cornflowerblue">同步操作文件</font>：代码会被阻塞，不会继续执行；</li> <li>方式二：<font color="cornflowerblue">异步回调函数操作文件</font>：代码不会被阻塞，需要传入回调函数，当获取到结果时，回调函数被执行；</li> <li>方式三：<font color="cornflowerblue">异步Promise操作文件</font>：代码不会被阻塞，通过 fs.promises 调用方法操作，会返回一个Promise，
可以通过then、catch进行处理；</li></ul></li></ul> <h4 id="_1-2-1-获取文件信息-state"><a href="#_1-2-1-获取文件信息-state" class="header-anchor">#</a> 1.2.1：获取文件信息 state</h4> <p><strong>主要获取一个文件的状态为例：</strong></p> <p>方式一 ：同步操作</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath<span class="token operator">=</span><span class="token string">&quot;./abc.txt&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> info <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span><span class="token string">&quot;./01.js&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;后续要执行的代码&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

运行结果为：先打印文件的状态信息，然后打印，后面执行代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>方式二：异步回调函数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath<span class="token operator">=</span><span class="token string">&quot;./abc.txt&quot;</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>info</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;后续要执行的代码&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

运行结果为：先打印后面执行代码<span class="token punctuation">,</span> 然后打印文件的状态信息，
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>方式三：异步Promise操作</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath<span class="token operator">=</span><span class="token string">&quot;./abc.txt&quot;</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;后续要执行的代码&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

运行结果为：先打印后面执行代码<span class="token punctuation">,</span> 然后打印文件的状态信息，
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_1-2-2-文件描述符-open"><a href="#_1-2-2-文件描述符-open" class="header-anchor">#</a> 1.2.2：文件描述符 open</h4> <p><strong>fs.open() 方法用于分配新的文件描述符。</strong></p> <ul><li>一旦被分配，则文件描述符可用于从文件读取数据、向文件写入数据、或请求关于文件的信息。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>info</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   fs<span class="token punctuation">.</span><span class="token function">fstat</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_1-2-3-读取文件-readfile"><a href="#_1-2-3-读取文件-readfile" class="header-anchor">#</a> 1.2.3：读取文件  readFile</h4> <p><strong>对文件的内容进行读取</strong></p> <h5 id="_1-2-3-1-字符编码-encoding"><a href="#_1-2-3-1-字符编码-encoding" class="header-anchor">#</a> **1.2.3.1： 字符编码   encoding   **</h5> <p><strong>encoding</strong>：字符编码，目前基本用的都是UTF-8编码；</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath <span class="token operator">=</span> <span class="token string">&quot;./abc.txt&quot;</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&quot;utf-8&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_1-2-4-文件写入-writefile"><a href="#_1-2-4-文件写入-writefile" class="header-anchor">#</a> 1.2.4：文件写入  writeFile</h4> <p><strong>对文件的内容进行写入</strong></p> <h5 id="_1-2-4-1-写入方式-flag"><a href="#_1-2-4-1-写入方式-flag" class="header-anchor">#</a> 1.2.4.1： 写入方式     flag</h5> <ul><li>flag的值有很多：https://nodejs.org/dist/latest-v14.x/docs/api/fs.html#fs_file_system_flags
<ul><li><strong>w</strong>    打开文件写入，默认值；</li> <li>**w+  **  打开文件进行读写，如果不存在则创建文件；</li> <li><strong>r+</strong>   打开文件进行读写，如果不存在那么抛出异常；</li> <li><strong>r</strong>   打开文件读取，读取时的默认值；</li> <li><strong>a</strong>   打开要写入的文件，将流放在文件末尾。如果不存在则创建文件；</li> <li><strong>a+</strong>  打开文件以进行读写，将流放在文件末尾。如果不存在则创建文件</li></ul></li></ul> <p><strong>文件写入</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filePath <span class="token operator">=</span> <span class="token string">&quot;./abc.txt&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&quot;越努力越幸运&quot;</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token string">&quot;a+&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_1-2-4-查找文件夹-fs-existssync"><a href="#_1-2-4-查找文件夹-fs-existssync" class="header-anchor">#</a> 1.2.4：查找文件夹 fs.existsSync</h4> <p><strong>语法：</strong> <strong>fs.existsSync(pach);</strong></p> <ul><li>以同步的方法检测目录是否存在。</li> <li>如果目录存在 返回 <strong>true</strong> ，如果目录不存在 返回<strong>false</strong></li></ul> <h4 id="_1-2-5-文件夹创建-fs-mkdir"><a href="#_1-2-5-文件夹创建-fs-mkdir" class="header-anchor">#</a> 1.2.5：文件夹创建  fs.mkdir</h4> <p><strong>以异步的方式创建文件目录。如果目录已存在，将抛出异常。</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token string">&quot;./lys&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_1-2-6-文件重命名-rename"><a href="#_1-2-6-文件重命名-rename" class="header-anchor">#</a> 1.2.6：文件重命名  rename</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>const fs=require(&quot;fs&quot;);
fs.rename(&quot;./why&quot;,&quot;./lys&quot;,(err)=&gt;{
    console.log(err);
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_1-2-7-读取文件夹中的所有文件-readdir"><a href="#_1-2-7-读取文件夹中的所有文件-readdir" class="header-anchor">#</a> 1.2.7：读取文件夹中的所有文件    readdir</h4> <p><strong>读取当前目录的所有文件名</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token string">&quot;./lys&quot;</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>读取文件夹中所有文件</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token string">&quot;./lys&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">withFileTypes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> filepath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                <span class="token function">getFiles</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">getFiles</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="_1-2-8-events模块"><a href="#_1-2-8-events模块" class="header-anchor">#</a> 1.2.8：events模块</h4> <ul><li><strong>Node中的核心API都是基于异步事件驱动的：</strong> <ul><li>在这个体系中，某些对象（发射器（Emitters））发出某一个事件；</li> <li>我们可以监听这个事件（监听器 Listeners），并且传入的回调函数，这个回调函数会在监听到事件时调用；</li></ul></li></ul> <p><font color="cornflowerblue"><strong>发出事件和监听事件都是通过类来完成的，它们都属于events对象</strong></font></p> <h5 id="_1-2-8-1-监听事件-emitter-on"><a href="#_1-2-8-1-监听事件-emitter-on" class="header-anchor">#</a> 1..2.8.1：监听事件：emitter.on</h5> <p><strong>emitter.on(eventName, listener)：监听事件，也可以使用addListener；</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Events<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;监听1到click事件&quot;</span><span class="token operator">+</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_1-2-8-2-移除事件-emitter-off"><a href="#_1-2-8-2-移除事件-emitter-off" class="header-anchor">#</a> 1.2.8.2：移除事件：emitter.off</h5> <p><strong>emitter.off(eventName, listener)：移除事件监听，也可以使用removeListener；</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Events<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">listener2</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">args2</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;监听2到click事件&quot;</span><span class="token operator">+</span>args2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span>listener2<span class="token punctuation">)</span>
bus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span>listener2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="_1-2-8-3-移除所有监听事件"><a href="#_1-2-8-3-移除所有监听事件" class="header-anchor">#</a> 1.2.8.3：移除所有监听事件</h5> <p><strong>移除所有的监听事件</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>bus.removeAllListeners();  移除所有监听事件
bus.removeAllListeners(&quot;click&quot;);  移除所有监听click事件
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_1-2-8-4-发出事件-emitter-emit"><a href="#_1-2-8-4-发出事件-emitter-emit" class="header-anchor">#</a> 1.2.8.4：发出事件：emitter.emit</h5> <p><strong>emitter.emit(eventName[, ...args])：发出事件，可以携带一些参数；</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Events<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;监听1到click事件&quot;</span><span class="token operator">+</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;加油&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="_1-2-8-5-获取注册事件-eventnames"><a href="#_1-2-8-5-获取注册事件-eventnames" class="header-anchor">#</a> 1.2.8.5：获取注册事件 eventNames</h5> <p><strong>获取所有添加的事件的类型</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Events<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;监听1到click事件&quot;</span><span class="token operator">+</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;tap&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;监听到tap事件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bus<span class="token punctuation">.</span><span class="token function">eventNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//   [ 'click', 'tap' ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="四-包管理工具"><a href="#四-包管理工具" class="header-anchor">#</a> 四：包管理工具</h2> <h3 id="_1-1-包管理工具npm"><a href="#_1-1-包管理工具npm" class="header-anchor">#</a> 1.1：包管理工具npm</h3> <p><strong>通过第二种方式我们可以更好的管理自己的工具包，其他人也可以更好的使用我们的工具包。</strong></p> <ul><li><p>包管理工具npm：</p> <ul><li>Node Package Manager，也就是Node包管理器；</li> <li>但是目前已经不仅仅是Node包管理器了，在前端项目中我们也在使用它来管理依赖的包；</li> <li>比如express、koa、react、react-dom、axios、babel、webpack等等；</li></ul></li> <li><p>npm管理的包可以在哪里查看、搜索呢？</p> <ul><li>https://www.npmjs.com/</li> <li>这是我们安装相关的npm包的官网；</li></ul></li> <li><p>npm管理的包存放在哪里呢？</p> <ul><li>我们发布自己的包其实是发布到<font color="orange">registry</font>上面的；</li> <li>p 当我们安装一个包时其实是从registry上面下载的包；</li></ul></li></ul> <h3 id="_1-2-配置文件-package-json"><a href="#_1-2-配置文件-package-json" class="header-anchor">#</a> 1.2：配置文件 package.json</h3> <ul><li>我们每一个<font color="orange">项目都会有一个对应的配置文件</font>，无论是前端项目还是后端项目：
<ul><li>这个配置文件会<font color="cornflowerblue">记录着你项目的名称、版本号、项目描述等</font>；</li> <li>也会记录着你项<font color="cornflowerblue">目所依赖的其他库的信息和依赖库的版本号</font>；</li></ul></li></ul> <h4 id="_1-2-1-创建package-json"><a href="#_1-2-1-创建package-json" class="header-anchor">#</a> 1.2.1：创建package.json</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm init -y                 //  所有信息使用默认的
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>npm init                    //  这个创建是需要填写信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_1-2-2-常见的属性"><a href="#_1-2-2-常见的属性" class="header-anchor">#</a> 1.2.2：常见的属性</h4> <p><img src="/images/node/image-20210721172349082.png" alt="image-20210721172349082"></p> <ul><li><p><font color="cornflowerblue">name</font>是项目的名称；<font color="red">（必填）</font></p></li> <li><p><font color="cornflowerblue">version</font>是当前项目的版本号； <font color="red">(必填)</font></p></li> <li><p><font color="cornflowerblue">description</font>是描述信息，很多时候是作为项目的基本描述；</p></li> <li><p><font color="cornflowerblue">main</font>是设置程序的入口</p> <ul><li>是在你发布一个模块的时候会用到的；</li> <li>比如我们使用axios模块 <font color="cornflowerblue">const axios = require('axios')</font>;</li> <li>实际上是找到对应的<font color="cornflowerblue">main</font>属性查找文件的；</li></ul></li> <li><p><font color="cornflowerblue">author</font>是作者相关信息（发布时用到）；</p></li> <li><p><font color="cornflowerblue">license</font>是开源协议（发布时用到）；</p></li> <li><p><font color="cornflowerblue">private</font>属性：</p> <ul><li>private属性记录当前的<font color="cornflowerblue">项目是否是私有的</font>；</li> <li>当值为true时，npm是不能发布它的，这是防止私有项目或模块发布出去的方式；</li></ul></li> <li><p><font color="cornflowerblue">scripts</font>属性：</p> <ul><li>scripts属性用于<font color="cornflowerblue">配置一些脚本命令</font>，以键值对的形式存在；</li> <li>配置后我们可以通过 <font color="cornflowerblue">npm run 命令的key来执行</font>这个命令；</li> <li><font color="cornflowerblue">npm start和npm run start</font>的区别是什么？
<ul><li><font color="orange">它们是等价的</font>；</li> <li>对于常用的 start、 test、stop、restart可<font color="orange">以省略掉run直接通过 npm start等方式运行</font>；</li></ul></li></ul></li> <li><p><font color="cornflowerblue">dependencies</font>属性</p> <ul><li>dependencies属性是指定无论开发环境还是<font color="orange">生成环境都需要依赖的包</font>；</li> <li>通常是我们<font color="orange">项目实际开发用到的一些库模块</font>；</li> <li>与之对应的是<font color="cornflowerblue">devDependencies</font>；</li></ul></li> <li><p><font color="cornflowerblue"> devDependencies</font>属性</p> <ul><li>一些包在<font color="orange">生成环境是不需要的</font>，比如<font color="orange">webpack、babel</font>等；</li> <li>这个时候我们会通过 <font color="orange">npm install webpack --save-dev</font>，将它安装到<font color="orange">devDependencies</font>属性中；</li></ul></li></ul> <h4 id="_1-2-3-版本管理"><a href="#_1-2-3-版本管理" class="header-anchor">#</a> 1.2.3：版本管理</h4> <p><font color="cornflowerblue">会发现安装的依赖版本出现：^2.0.3或~2.0.3，这是什么意思呢？</font></p> <p>我们这里解释一下 ^和~的区别：</p> <ul><li><font color="orange">^x.y.z：</font>表示x是保持不变的，y和z永远安装最新的版本；</li> <li><font color="orange">~x.y.z：</font>表示x和y保持不变的，z永远安装最新的版本；</li></ul> <h3 id="_1-3-npm-install-命令"><a href="#_1-3-npm-install-命令" class="header-anchor">#</a> 1.3：npm install 命令</h3> <ul><li><p>安装npm包分两种情况：</p> <ul><li>全局安装（global install）： npm install yarn -g</li> <li>项目（局部）安装（local install）： npm instal</li></ul></li> <li><p>全局安装</p> <ul><li>全局安装是直接将某个包安装到全局：</li> <li>比如yarn的全局安装：   npm install yarn -g</li></ul></li> <li><p>但是很多人对全局安装有一些误会：</p> <ul><li>通常使用npm全局安装的包都是一些工具包：yarn、webpack等；</li> <li>并不是类似于 axios、express、koa等库文件；</li> <li>所以全局安装了之后并不能让我们在所有的项目中使用 axios等库</li></ul></li></ul> <h4 id="_1-3-1-项目安装-npm-install"><a href="#_1-3-1-项目安装-npm-install" class="header-anchor">#</a> 1.3.1 ：项目安装 npm install</h4> <p><strong>项目安装会在当前目录下生产一个 node_modules 文件夹</strong></p> <ul><li>局部安装分为
<ul><li>开发时依赖</li> <li>生产时依赖</li></ul></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 安装开发和生产依赖
    npm install axios
    npm i axios
# 开发依赖	
    npm install webpack --save-dev
    npm install webpack -D
    npm i webpack –D
# 根据package.json中的依赖包
    npm install
    npm i
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_1-3-2-卸载依赖包-npm-uninstall"><a href="#_1-3-2-卸载依赖包-npm-uninstall" class="header-anchor">#</a> 1.3.2：卸载依赖包 npm uninstall</h4> <p><strong>卸载某个依赖包</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm uninstall package
npm uninstall package --save-dev
npm uninstall package -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_1-3-3-强制重新-build"><a href="#_1-3-3-强制重新-build" class="header-anchor">#</a> 1.3.3：强制重新 build</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm rebuild
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_1-3-4-清除缓存"><a href="#_1-3-4-清除缓存" class="header-anchor">#</a> 1.3.4：清除缓存</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm cache clean
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_1-3-5-npm-install-原理"><a href="#_1-3-5-npm-install-原理" class="header-anchor">#</a> 1.3.5：npm install 原理</h4> <p><img src="C:%5CUsers%5C111%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210721225844715.png" alt="image-20210721225844715"></p> <p><strong>原理图解析</strong></p> <ul><li>npm install会检测是有package-lock.json文件
<ul><li>没有lock文件
<ul><li>分析依赖关系，这是因为我们可能包会依赖其他的包，并且多个包之间会产生相同依赖的情况；</li> <li>从registry仓库中下载压缩包（如果我们设置了镜像，那么会从镜像服务器下载压缩包）；</li> <li>获取到压缩包后会对压缩包进行缓存（从npm5开始有的）；</li> <li>将压缩包解压到项目的node_modules文件夹中（前面我们讲过，require的查找顺序会在该包下面查找）；</li></ul></li> <li>有lock文件
<ul><li>检测lock中包的版本是否和package.json中一致（会按照semver版本规范检测）；
<ul><li>不一致，那么会重新构建依赖关系，直接会走顶层的流程；</li></ul></li> <li>一致的情况下，会去优先查找缓存；
<ul><li>没有找到，会从registry仓库下载，直接走顶层流程；</li></ul></li> <li>查找到，会获取缓存中的压缩文件，并且将压缩文件解压到node_modules文件夹中。</li></ul></li></ul></li></ul> <h3 id="_1-4-package-lock-json"><a href="#_1-4-package-lock-json" class="header-anchor">#</a> 1.4：package-lock.json</h3> <ul><li>package-lock.json文件解析；</li> <li>name：项目的名称；</li> <li>version：项目的版本；</li> <li>lockfileVersion：lock文件的版本；</li> <li>requires：使用requires来跟着模块的依赖关系；</li> <li>dependencies：项目的依赖
<ul><li>当前项目依赖axios，但是axios依赖followredireacts；</li> <li>axios中的属性如下:
<ul><li>version表示实际安装的axios的版本；</li> <li>resolved用来记录下载的地址，registry仓库 中的位置；</li> <li>requires记录当前模块的依赖；</li> <li>integrity用来从缓存中获取索引，再通过索引 去获取压缩包文件</li></ul></li></ul></li></ul> <p><img src="C:%5CUsers%5C111%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210721235458081.png" alt="image-20210721235458081"></p> <h2 id="五-开发脚手架工具"><a href="#五-开发脚手架工具" class="header-anchor">#</a> 五：开发脚手架工具</h2> <h3 id="_1-1-自定义终端命令过程"><a href="#_1-1-自定义终端命令过程" class="header-anchor">#</a> 1.1：自定义终端命令过程</h3> <ul><li><p>创建index.js</p> <ul><li>可以编写一些简单的代码</li></ul></li> <li><p>创建package.json</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm init <span class="token operator">-</span>y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>创建coderlys命令</p> <ul><li><p>入口文件中，添加如下指令</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改package.json</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string-property property">&quot;bin&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
	<span class="token string-property property">&quot;coderlys&quot;</span><span class="token operator">:</span><span class="token string">&quot;index.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>将bin和环境变量进行链接配置，才能找到指令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm link
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li></ul> <h3 id="_1-2-version-help-option开发"><a href="#_1-2-version-help-option开发" class="header-anchor">#</a> 1.2：version-help-option开发</h3> <ul><li><p>定义查看版本号</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install commander  <span class="token comment">//安装</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;commander&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//导入</span>
program<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./package.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span> <span class="token comment">//设置版本号</span>
program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//解析终端指令</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>添加其他选项，修改帮助选项</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d --dest &lt;dest&gt;'</span><span class="token punctuation">,</span> <span class="token string">'a destination folder,例如：-d src/pages,错误/src/pages'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>监听--help</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> program<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'--help'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;.... coderlys -V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;.... coderlys -d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h2 id="六-buffer的使用"><a href="#六-buffer的使用" class="header-anchor">#</a> 六：Buffer的使用</h2> <h3 id="_1-1-数据的二进制"><a href="#_1-1-数据的二进制" class="header-anchor">#</a> 1.1：数据的二进制</h3> <ul><li>计算机中所有的内容：文字、数字、图片、音频、视频最终都会使用二进制来表示。</li> <li>JavaScript可以直接去处理非常直观的数据：比如字符串，我们通常展示给用户的也是这些内容。</li> <li>不对啊，JavaScript不是也可以处理图片吗？
<ul><li>事实上在网页端，图片我们一直是交给浏览器来处理的；</li> <li>JavaScript或者HTML，只是负责告诉浏览器一个图片的地址；</li> <li>浏览器负责获取这个图片，并且最终讲这个图片渲染出来；</li></ul></li> <li>但是对于服务器来说是不一样的：
<ul><li>服务器要处理的本地文件类型相对较多;</li> <li>比如某一个保存文本的文件并不是使用 utf-8进行编码的，而是用 GBK，那么我们必须读取到他们的二进制数据，再通过GKB转换 成对应的文字；</li> <li>比如我们需要读取的是一张图片数据（二进制），再通过某些手段对图片数据进行二次的处理（裁剪、格式转换、旋转、添加滤 镜），Node中有一个Sharp的库，就是读取图片或者传入图片的Buffer对其再进行处理；</li> <li>比如在Node中通过TCP建立长连接，TCP传输的是字节流，我们需要将数据转成字节再进行传入，并且需要知道传输字节的大小 （客服端需要根据大小来判断读取多少内容）；</li></ul></li></ul> <h3 id="_1-2-buffer和二进制"><a href="#_1-2-buffer和二进制" class="header-anchor">#</a> 1.2：Buffer和二进制</h3> <ul><li>我们会发现，对于前端开发来说，通常很少会和二进制打交道，但是对于服务器端为了做很多的功能，我们必须直接去操 作其二进制的数据；</li> <li>所以Node为了可以方便开发者完成更多功能，提供给了我们一个类Buffer，并且它是全局的。</li> <li>我们前面说过，Buffer中存储的是二进制数据，那么到底是如何存储呢？
<ul><li>我们可以将Buffer看成是一个存储二进制的数组；</li> <li>这个数组中的每一项，可以保存8位二进制： 00000000；</li></ul></li> <li>为什么是8位呢？
<ul><li>在计算机中，很少的情况我们会直接操作一位二进制，因为一位二进制存储的数据是非常有限的；</li> <li>所以通常会将8位合在一起作为一个单元，这个单元称之为一个字节（byte）；</li> <li>也就是说 1byte = 8bit，1kb=1024byte，1M=1024kb;</li> <li>比如很多编程语言中的int类型是4个字节，long类型时8个字节；</li> <li>比如TCP传输的是字节流，在写入和读取时都需要说明字节的个数；</li> <li>比如RGB的值分别都是255，所以本质上在计算机中都是用一个字节存储的；</li></ul></li></ul> <h3 id="_1-3-buffer的创建"><a href="#_1-3-buffer的创建" class="header-anchor">#</a> 1.3：Buffer的创建</h3> <p>Buffer相当于是一个字节的数组，数组中的每一项对于一个字节的大小；</p> <p>第一种方式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> buffer02<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Buffer<span class="token punctuation">.</span>from</span><span class="token punctuation">(</span><span class="token string">&quot;lys&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer02<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &lt;Buffer 6c 79 73&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer02<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//lys</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer02<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//lys</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第二种方式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> buffer03<span class="token operator">=</span>Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer03<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &lt;Buffer 00 00 00 00 00 00 00 00&gt;</span>

buffer03<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buffer03<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">66</span><span class="token punctuation">;</span>
buffer03<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x88</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer03<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 61</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer03<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  &lt;Buffer 61 42 88 00 00 00 00 00&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>第三种方式 （不推荐使用，快已过期）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token keyword">const</span> buffer01<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">&quot;lys&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer01<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 6c 79 73&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果编码和解码不同的时候（会进行乱码的）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> buffer<span class="token operator">=</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;加油&quot;</span><span class="token punctuation">,</span><span class="token string">'utf16le'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> str<span class="token operator">=</span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>  <span class="token comment">// �R�l  </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_1-4-buffer的创建过程"><a href="#_1-4-buffer的创建过程" class="header-anchor">#</a> 1.4：Buffer的创建过程</h3> <p><strong>事实上我们创建Buffer时，并不会频繁的向操作系统申请内存，它会默认先申请一个8 * 1024个字节大小的内存，也就是8kb</strong></p> <h3 id="_1-5-buffer对文件的读取"><a href="#_1-5-buffer对文件的读取" class="header-anchor">#</a> 1.5：Buffer对文件的读取</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./abc.txt&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &lt;Buffer e4 b8 8d e6 96 ad e5 8a a0 e6 b2 b9 ef bc 8c e4 b8 8d e6 96 ad e5 8a aa e5 8a 9b e3 80 82&gt;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 不断加油，不断努力</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_1-6-buffer对图片的读取和写入"><a href="#_1-6-buffer对图片的读取和写入" class="header-anchor">#</a> 1.6：Buffer对图片的读取和写入</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./index_bg.jpg&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&lt;Buffer ff d8 ff e1 20 c0 45 76120 more bytes&gt;</span>

    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;./abc.jpg&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 对index_bg.jpg的Buffer的数据传递给abc.jpg,进行复制图片</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//null</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_1-7-使用sharp的库"><a href="#_1-7-使用sharp的库" class="header-anchor">#</a> 1.7：使用Sharp的库</h3> <p>截取图片 第一种</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> sharp <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sharp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">sharp</span><span class="token punctuation">(</span><span class="token string">'./abc.jpg'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token string">'./ab.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>截取图片 第二种</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sharp <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sharp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sharp</span><span class="token punctuation">(</span><span class="token string">&quot;./abc.jpg&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment">//&lt;Buffer ff d8 ff db 00 43 00 0 14603 more bytes&gt;</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./abc.jpg'</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token parameter">err</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="七-事件循环和异步io"><a href="#七-事件循环和异步io" class="header-anchor">#</a> 七：事件循环和异步IO</h2> <ul><li>事件循环是什么？
<ul><li>事实上我把事件循环理解成<font color="cornflowerblue">我们编写的JavaScript和浏览器或者Node之间的一个桥梁</font>。</li></ul></li> <li>浏览器的事件循环是<font color="cornflowerblue">一个我们编写的JavaScript代码和浏览器API调用(setTimeout/AJAX/监听事件等)的一个桥梁,  桥梁之间他们通过回调函数进行沟通。</font></li> <li>Node的事件循环<font color="cornflowerblue">是一个我们编写的JavaScript代码和系统调用（file system、network等）之间的一个桥梁, 桥梁 之间他们通过回调函数进行沟通的</font>。</li></ul> <p><img src="/images/node/image-20210728163147790.png" alt="image-20210728163147790"></p> <h3 id="_1-1-进程和线程"><a href="#_1-1-进程和线程" class="header-anchor">#</a> 1.1：进程和线程</h3> <ul><li>进程和线程是操作系统中的两个概念：
<ul><li>进程（process）：计算机已经运行的程序；</li> <li>线程（thread）：操作系统能够运行运算调度的最小单位；</li></ul></li> <li>听起来很抽象，我们直观一点解释：
<ul><li>进程：我们可以认为，启动一个应用程序，就会默认启动一个进程（也可能是多个进程）；</li> <li>线程：每一个进程中，都会启动一个线程用来执行程序中的代码，这个线程被称之为主线程；</li> <li>所以我们也可以说进程是线程的容器；</li></ul></li> <li>再用一个形象的例子解释：
<ul><li>操作系统类似于一个工厂；</li> <li>工厂中里有很多车间，这个车间就是进程；</li> <li>每个车间可能有一个以上的工人在工厂，这个工人就是线程；</li></ul></li></ul> <h3 id="_1-2-多进程多线程开发"><a href="#_1-2-多进程多线程开发" class="header-anchor">#</a> 1.2：多进程多线程开发</h3> <ul><li>操作系统是如何做到同时让多个进程（边听歌、边写代码、边查阅资料）同时工作呢？
<ul><li>这是因为CPU的运算速度非常快，它可以快速的在多个进程之间迅速的切换；</li> <li>当我们的进程中的线程获取获取到时间片时，就可以快速执行我们编写的代码；</li> <li>对于用于来说是感受不到这种快速的切换的；</li></ul></li></ul> <p><img src="/images/node/image-20210728164148401.png" alt="image-20210728164148401"></p> <h3 id="_1-3-浏览器和javascript"><a href="#_1-3-浏览器和javascript" class="header-anchor">#</a> 1.3：浏览器和JavaScript</h3> <ul><li>我们经常会说<font color="cornflowerblue">JavaScript是单线程的</font>，但是<font color="orange">JavaScript的线程应该有自己的容器进程：浏览器或者Node</font>。</li> <li>浏览器是一个进程吗，它里面只有一个线程吗？
<ul><li>目前多数的<font color="cornflowerblue">浏览器其实都是多进程的</font>，当我们打开一个<font color="cornflowerblue">tab页面时就会开启一个新的进程</font>，这是为了<font color="cornflowerblue">防止一个页面卡死</font>而造成所有页面无法响应，整个浏览器需要强制退出；</li> <li>每个<font color="cornflowerblue">进程中又有很多的线程，其中包括执行JavaScript代码的线程</font>；</li></ul></li> <li>但是<font color="cornflowerblue">JavaScript的代码执行是在一个单独的线程中执行</font>的：
<ul><li>这就意味着JavaScript的代码，在<font color="cornflowerblue">同一个时刻只能做一件事</font>；</li> <li>如果这件事是非常耗时的，就意味着当前的线程就会被阻塞；</li></ul></li></ul> <h3 id="_1-4-浏览器的事件循环"><a href="#_1-4-浏览器的事件循环" class="header-anchor">#</a> 1.4：浏览器的事件循环</h3> <ul><li>如果在执行JavaScript代码的过程中，有异步操作呢？
<ul><li>中间我们插入了一个<font color="orange">setTimeout</font>的函数调用；</li> <li>这个函数<font color="cornflowerblue">被放到入调用栈中，执行会立即结束，并不会阻塞后续代码的执行</font>；</li></ul></li> <li>那么，传入的一个函数（比如我们称之为timer函数），会在什么时候被执行呢？
<ul><li>事实上，setTimeout是调用了web api，在合适的时机，会将timer函数加入到一个事件队列中；</li> <li>事件队列中的函数，会被放入到调用栈中，在调用栈中被执行；</li></ul></li></ul> <p><img src="/images/node/image-20210728172910047.png" alt="image-20210728172910047"></p> <h3 id="_1-5-宏任务和微任务"><a href="#_1-5-宏任务和微任务" class="header-anchor">#</a> 1.5：宏任务和微任务</h3> <ul><li>但是事件循环中并非只维护着一个队列，事实上是有两个队列：
<ul><li><font color="orange">宏任务队列</font>（macrotask queue）：ajax、setTimeout、setInterval、DOM监听、UI Rendering等</li> <li><font color="orange">微任务队列</font>（microtask queue）：Promise的then回调、 Mutation Observer API、queueMicrotask()等</li></ul></li> <li>那么事件循环对于两个队列的优先级是怎么样的呢？
<ol><li>main script中的代码优先执行（编写的顶层script代码）；</li> <li>在执行任何一个宏任务之前（不是队列，是一个宏任务），都会先查看微任务队列中是否有任务需要执行；
<ol><li>也就是宏任务执行之前，必须保证微任务队列是空的；</li> <li>如果不为空，那么就优先执行微任务队列中的任务（回调）；</li></ol></li></ol></li></ul> <h3 id="_1-6-node的架构分析"><a href="#_1-6-node的架构分析" class="header-anchor">#</a> 1.6：Node的架构分析</h3> <ul><li>浏览器中的EventLoop是根据HTML5定义的规范来实现的，不同的浏览器可能会有不同的实现，而Node中是由
libuv实现的。</li> <li>Node架构图：
<ul><li>我们会发现libuv中主要维护了一个EventLoop和worker threads（线程池）；</li> <li>EventLoop负责调用系统的一些其他操作：文件的IO、Network、child-processes等</li></ul></li> <li>libuv是一个多平台的专注于异步IO的库，它最初是为Node开发的，但是现在也被使用到Luvit、Julia、pyuv等其
他地方；</li></ul> <p><img src="/images/node/image-20210728174304648.png" alt="image-20210728174304648"></p> <h3 id="_1-7-阻塞io和非阻塞io"><a href="#_1-7-阻塞io和非阻塞io" class="header-anchor">#</a> 1.7：阻塞IO和非阻塞IO</h3> <ul><li>如果我们希望在程序中对一个文件进行操作，那么我们就需要打开这个文件：<font color="cornflowerblue">通过文件描述符</font>。
<ul><li>我们思考：JavaScript可以直接对一个文件进行操作吗？</li> <li>看起来是可以的，但是事实上我们任何程序中的<font color="cornflowerblue">文件操作都是需要进行系统调用</font>（操作系统的文件系统）；</li> <li>事实上对文件的操作，是<font color="cornflowerblue">一个操作系统的IO操作</font>（输入、输出）；</li></ul></li> <li>操作系统为我们提供了<font color="orange">阻塞式</font>调用和<font color="orange">非阻塞式</font>调用：
<ul><li><font color="cornflowerblue">阻塞式调用</font>： 调用结果返回之前，当前线程处于阻塞态（阻塞态CPU是不会分配时间片的），调用线程只有
在得到调用结果之后才会继续执行。</li> <li><font color="cornflowerblue">非阻塞式调用</font>： 调用执行之后，当前线程不会停止执行，只需要过一段时间来检查一下有没有结果返回即可。</li></ul></li> <li>所以我们开发中的很多耗时操作，都可以基于这样的 <font color="orange">非阻塞式调用</font>：
<ul><li>比如网络请求本身使用了Socket通信，而Socket本身提供了select模型，可以进行非阻塞方式的工作；</li> <li>比如文件读写的IO操作，我们可以使用操作系统提供的基于事件的回调机制；</li></ul></li></ul> <h4 id="_1-7-1-非阻塞io的问题"><a href="#_1-7-1-非阻塞io的问题" class="header-anchor">#</a> 1.7.1：非阻塞IO的问题</h4> <ul><li>但是非阻塞IO也会存在一定的问题：我们并没有获取到需要读取（我们以读取为例）的结果
<ul><li>那么就意味着为了可以知道是否读取到了完整的数据，我们需要频繁的去确定读取到的数据是否是完整的；</li> <li>这个过程我们称之为<font color="cornflowerblue">轮训操作</font>；</li></ul></li> <li>那么这个轮训的工作由谁来完成呢？
<ul><li>如果我们的主线程频繁的去进行轮训的工作，那么必然会大大降低性能；</li> <li>并且开发中我们可能不只是一个文件的读写，可能是多个文件；</li> <li>而且可能是多个功能：网络的IO、数据库的IO、子进程调用；</li></ul></li> <li>libuv提供了一个<font color="cornflowerblue">线程池（Thread Pool）</font>：
<ul><li>线程池会负责所有相关的操作，并且会通过轮训等方式等待结果；</li> <li>当获取到结果时，就可以将对应的回调放到事件循环（某一个事件队列）中；</li> <li>事件循环就可以负责接管后续的回调工作，告知JavaScript应用程序执行对应的回调函数；</li></ul></li></ul> <h4 id="_1-7-2-阻塞和非阻塞-同步和异步的区别"><a href="#_1-7-2-阻塞和非阻塞-同步和异步的区别" class="header-anchor">#</a> 1.7.2：阻塞和非阻塞，同步和异步的区别？</h4> <ul><li>阻塞和非阻塞是对于被调用者来说的；
<ul><li>在我们这里就<font color="cornflowerblue">是系统调用</font>，操作系统为我们<font color="cornflowerblue">提供了阻塞调用和非阻塞调用</font>；</li></ul></li> <li>同步和异步是对于调用者来说的；
<ul><li>在我们这里就是自己的程序；</li> <li>如果我们在<font color="cornflowerblue">发起调用之后，不会进行其他任何的操作，只是等待结果，这个过程就称之为同步调用</font>；</li> <li>如果我们再发起<font color="cornflowerblue">调用之后，并不会等待结果，继续完成其他的工作，等到有回调时再去执行，这个过程就是异步调用；</font></li></ul></li> <li>Libuv采用的就是非阻塞异步IO的调用方式；</li></ul> <h3 id="_1-8-node事件循环的阶段"><a href="#_1-8-node事件循环的阶段" class="header-anchor">#</a> 1.8：Node事件循环的阶段</h3> <ul><li>我们最前面就强调过，<font color="cornflowerblue">事件循环像是一个桥梁</font>，是连接着应用程序的JavaScript和系统调用之间的通道：
<ul><li>无论是我们的文件IO、数据库、网络IO、定时器、子进程，在完成对应的操作后，都会将对应的结果和回调
函数放到事件循环（任务队列）中；</li> <li>事件循环会不断的从任务队列中取出对应的事件（回调函数）来执行；</li></ul></li> <li>但是一次完整的事件循环Tick分成很多个阶段：
<ul><li><font color="cornflowerblue">定时器（Timers）</font>：本阶段执行已经被 setTimeout() 和 setInterval() 的调度回调函数。</li> <li><font color="cornflowerblue">待定回调（Pending Callback）</font>：对某些系统操作（如TCP错误类型）执行回调，比如TCP连接时接收到
ECONNREFUSED。</li> <li><font color="cornflowerblue">idle, prepare</font>：仅系统内部使用。</li> <li><font color="cornflowerblue">轮询（Poll）</font>：检索新的 I/O 事件；执行与 I/O 相关的回调；</li> <li><font color="cornflowerblue">检测</font>：setImmediate() 回调函数在这里执行。</li> <li><font color="cornflowerblue">关闭的回调函数</font>：一些关闭的回调函数，如：socket.on('close', ...)。</li></ul></li></ul> <h3 id="_1-9-node的微任务和宏任务"><a href="#_1-9-node的微任务和宏任务" class="header-anchor">#</a> 1.9：Node的微任务和宏任务</h3> <ul><li><p>我们会发现从一次事件循环的Tick来说，Node的事件循环更复杂，它也分为微任务和宏任务：</p> <ul><li>宏任务（macrotask）：setTimeout、setInterval、IO事件、setImmediate、close事件；</li> <li>微任务（microtask）：Promise的then回调、process.nextTick、queueMicrotask；</li></ul></li> <li><p>但是，Node中的事件循环不只是 微任务队列和 宏任务队列：</p> <ul><li><p>微任务队列：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>next tick queue：process<span class="token punctuation">.</span>nextTick；
other queue：Promise的then回调、queueMicrotask；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>宏任务队列：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>timer queue：setTimeout、setInterval；
poll queue：<span class="token constant">IO</span>事件；
check queue：setImmediate；
close queue：close事件；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li></ul> <h2 id="八-认识stream"><a href="#八-认识stream" class="header-anchor">#</a> 八：认识Stream</h2> <ul><li>什么事流呢？
<ul><li>我们的第一反应应该是流水，源源不断的流动；</li> <li>程序中的流也是类似的含义，<font color="cornflowerblue">我们可以想象当我们从一个文件中读取数据时，文件的二进制（字节）数据会源源不断的被读取</font>到我们程序中；</li> <li>而这个一连串的字节，就是我们程序中的流；</li></ul></li> <li>所以，我们可以这样理解流：
<ul><li>是连续字节的一种表现形式和抽象概念；</li> <li>流应该是可读的，也是可写的；</li></ul></li> <li>在之前学习文件的读写时，我们可以直接通过 readFile或者 writeFile方式读写文件，为什么还需要流呢？
<ul><li>直接读写文件的方式，虽然简单，但是<font color="cornflowerblue">无法控制一些细节</font>的操作；</li> <li>比如<font color="cornflowerblue">从什么位置开始读、读到什么位置、一次性读取多少个字节</font>；</li> <li>读到某个位置后，暂停读取，某个时刻恢复读取等等；</li> <li>或者这个文件非常大，比如一个视频文件，一次性全部读取并不合适；</li></ul></li></ul> <h3 id="_1-1-文件读写的stream"><a href="#_1-1-文件读写的stream" class="header-anchor">#</a> 1.1：文件读写的Stream</h3> <ul><li>事实上Node中很多对象是基于流实现的：
<ul><li>http模块的Request和Response对象；</li> <li>process.stdout对象；</li></ul></li> <li>官方：另外所有的流都是EventEmitter的实例</li> <li>Node.js中有四种基本流类型
<ul><li>Writable：可以向其写入数据的流（例如 fs.createWriteStream()）。</li> <li>Readable：可以从中读取数据的流 （例如 fs.createReadStream()）。</li> <li>Duplex：同时为Readadle和流Writable（例如 net.Socket）。</li> <li>Transform：Duplex可以在写入和读取数据时修改或转换数据的流（例如zlib.createDeflate()）。</li></ul></li></ul> <h4 id="_1-1-1-readadle的使用"><a href="#_1-1-1-readadle的使用" class="header-anchor">#</a> 1.1.1：readadle的使用</h4> <p>之前我们读取一个文件的信息</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs<span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.text&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">encoding</span><span class="token operator">:</span><span class="token string">&quot;utf8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>这种方式是一次性将一个文件中所有的内容都读取到程序（内存）中，但是这种读取方式就会出现我们之前提到的很多问题：</p> <ul><li>文件过大、读取的位置、结束的位置、一次读取的大小；</li></ul></li> <li><p>这个时候，我们可以使用 createReadStream，我们来看几个参数，更多参数可以参考官网：</p> <ul><li>start：文件读取开始的位置</li> <li>end：文件读取结束的位置</li> <li>highWaterMark：一次性读取字节的长度，默认是64Kb;</li></ul></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs<span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> read<span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&quot;./a.text&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">end</span><span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span>
    <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token literal-property property">encoding</span><span class="token operator">:</span><span class="token string">&quot;utf8&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
read<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件被打开&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 监听文件的打开</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
read<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印文件的内容</span>
    read<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        read<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//开启</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
read<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件读取结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听文件读取完</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
read<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件被关闭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听文件被关闭</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li></ul> <h4 id="_1-1-2-writable的使用"><a href="#_1-1-2-writable的使用" class="header-anchor">#</a> 1.1.2：Writable的使用</h4> <p>之前我们写入一个文件的方式是这样的</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data<span class="token operator">=</span><span class="token string">&quot;666&quot;</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;./b.text&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">flag</span><span class="token operator">:</span><span class="token string">&quot;a+&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>这种方式相当于一次性将所有的内容写入到文件中，但是这种方式<font color="cornflowerblue">也有很问题</font>。
<ul><li>比如我们希望一点点写入内容，精确每次写入的位置等。</li></ul></li> <li>这个时候，我们可以使用createWriteStream，我们来看几个参数，更多参数可以参考官网
<ul><li>flags：默认是w,如果我们希望是追加写入，可以使用a或者a+</li> <li>start：写入的位置</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data<span class="token operator">=</span><span class="token string">&quot;99&quot;</span>

<span class="token keyword">let</span> writer<span class="token operator">=</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">&quot;./b.text&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">flags</span><span class="token operator">:</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span><span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
writer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件打开&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//监听文件打开的时候</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">// 进行把内容写入文件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
writer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;加油&quot;</span><span class="token punctuation">)</span>	<span class="token comment">//写入结束</span>
writer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;finish&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件写入结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
writer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件关闭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h5 id="_1-1-2-1-end"><a href="#_1-1-2-1-end" class="header-anchor">#</a> 1.1.2.1：end</h5> <ul><li>我们会发现，我们并不能监听到 close 事件：
<ul><li>这是因为写入流在打开后是不会自动关闭的；</li> <li>我们必须手动关闭，来告诉Node已经写入结束了；</li> <li>并且会发出一个 finish 事件的；</li></ul></li> <li>另外一个非常常用的方法是 end：end方法相当于做了两步操作： write传入的数据和调用close方法</li></ul> <h4 id="_1-1-3-pipe方法"><a href="#_1-1-3-pipe方法" class="header-anchor">#</a> 1.1.3：pipe方法</h4> <p>我们可以将读取到的 输入流，手动的放到 输出流中进行写入</p> <p>之前的写法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./b.text&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;./c.text&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><font color="orange">pipe</font>：我们也可以通过pipe来完成这样的操作：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> reader<span class="token operator">=</span>fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&quot;./c.text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> writer<span class="token operator">=</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">&quot;./d.text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="九-http-模块"><a href="#九-http-模块" class="header-anchor">#</a> 九：Http 模块</h2> <h3 id="_1-1-web服务器"><a href="#_1-1-web服务器" class="header-anchor">#</a> 1.1：web服务器</h3> <ul><li>什么是web服务器？
<ul><li>当应用程序（客户端）需要某一个资源时，可以向一个台服务器，通过Http请求获取到这个资源；<font color="orange">提供资源的这个服务器</font>，就是一个Web服务器；</li></ul></li></ul> <p><img src="/images/node/image-20210730141052516.png" alt="image-20210730141052516"></p> <p>目前有很多开源的Web服务器：Nginx、Apache（静态）、Apache Tomcat（静态、动态）、Node.js</p> <h3 id="_1-2-创建服务器"><a href="#_1-2-创建服务器" class="header-anchor">#</a> 1.2：创建服务器</h3> <p>方法一：</p> <ul><li><p>创建服务器对象，我们是通过 createServer 来完成的</p> <ul><li>创建服务器对象，我们是通过 createServer 来完成的</li></ul></li> <li><p>创建Server时会传入一个回调函数，这个回调函数在被调用时会传入两个参数：</p> <ul><li>req：<font color="orange">request</font>请求对象，包含<font color="orange">请求相关的信息</font>；</li> <li>res：<font color="orange">response</font>响应对象，包含我们要<font color="orange">发送给客户端的信息</font>；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:8081/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <p>方法二：</p> <ul><li><p>底层其实使用直接 new Server 对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">http<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;hello Server66&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server2<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:9000/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>server2<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9000  可以获取端口号</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <h3 id="_1-3-监听主机和端口号"><a href="#_1-3-监听主机和端口号" class="header-anchor">#</a> 1.3：监听主机和端口号</h3> <ul><li>Server通过listen方法来开启服务器，并且在某一个主机和端口上监听网络请求：
<ul><li>也就是当我们通过 ip:port的方式发送到我们监听的Web服务器上时；</li> <li>我们就可以对其进行相关的处理；</li></ul></li> <li><font color="cornflowerblue">listen函数有三个参数</font>：
<ul><li><font color="orange">端口port</font>: 可以不传, 系统会默认分配端, 后续项目中我们会写入到环境变量中；</li> <li><font color="orange">主机host</font>: 通常可以传入localhost、ip地址127.0.0.1、或者ip地址0.0.0.0，默认是0.0.0.0；
<ul><li><font color="cornflowerblue">localhost：本质上是一个域名，通常情况下会被解析成127.0.0.1</font>；</li> <li>127.0.0.1：回环地址（Loop Back Address），表达的意思其实是我们主机自己发出去的包，直接被自己接收；
<ul><li>正常的数据库包经常 应用层 - 传输层 - 网络层 - 数据链路层 - 物理层 ；</li> <li>而回环地址，是在网络层直接就被获取到了，是不会经常数据链路层和物理层的；</li> <li>比如<font color="cornflowerblue">我们监听 127.0.0.1时，在同一个网段下的主机中，通过ip地址是不能访问的</font>；</li></ul></li> <li>0.0.0.0：
<ul><li><font color="cornflowerblue">监听IPV4上所有的地址</font>，再根据端口找到不同的应用程序；</li> <li>比如<font color="cornflowerblue">我们监听 0.0.0.0时，在同一个网段下的主机中，通过ip地址是可以访问的</font>；</li></ul></li></ul></li> <li><font color="orange">回调函数</font>：服务器启动成功时的回调函数；</li></ul></li></ul> <h3 id="_1-4-request对象"><a href="#_1-4-request对象" class="header-anchor">#</a> 1.4：request对象</h3> <ul><li>在向服务器发送请求时，我们会携带很多信息，比如：
<ul><li>本次请求的URL，服务器需要根据不同的URL进行不同的处理；</li> <li>本次请求的请求方式，比如GET、POST请求传入的参数和处理的方式是不同的；</li> <li>本次请求的headers中也会携带一些信息，比如客户端信息、接受数据的格式、支持的编码格式等；</li></ul></li> <li>这些信息，Node会帮助我们封装到一个request的对象中，我们可以直接来处理这个request对象。</li></ul> <h4 id="_1-4-1-url处理"><a href="#_1-4-1-url处理" class="header-anchor">#</a> 1.4.1：URL处理</h4> <ul><li>客户端在发送请求时，会请求不同的数据，那么会传入不同的请求地址；</li> <li>服务器端需要根据不同的请求地址，作出不同的响应；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//url 传入地址 ：http://127.0.0.1:8081/logo?name=lys&amp;age=21</span>

<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//对request.url,对他进行解析呢，使用内置模块url：</span>
<span class="token keyword">var</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  querystring 对字符串链接进行拆分为对象</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/html;charset=utf-8&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token punctuation">{</span>pathname<span class="token punctuation">,</span> query<span class="token punctuation">}</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token comment">// pathname：/logo  , query ：name=lys&amp;age=21</span>
    
    <span class="token keyword">let</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span>age<span class="token punctuation">}</span> <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>   <span class="token comment">//  name:  lys , age: 21</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">===</span> <span class="token string">&quot;/logo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;登录&quot;</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// lys</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 21</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;错误&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:8081/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_1-4-2-method处理"><a href="#_1-4-2-method处理" class="header-anchor">#</a> 1.4.2：method处理</h4> <ul><li>在Restful规范（设计风格）中，我们对于数据的增删改查应该通过不同的请求方式：
<ul><li>GET：查询数据；</li> <li>POST：新建数据；</li> <li>PATCH：更新数据；</li> <li>DELETE：删除数据；</li></ul></li> <li>所以，我们可以通过判断不同的请求方式进行不同的处理。
<ul><li>比如创建一个用户；</li> <li>请求接口为 /users；</li> <li>请求方式为 POST请求；</li> <li>携带数据 username和password；</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//url传递的数据是 ： http://127.0.0.1:8081/logo</span>
<span class="token comment">// body 里写的数据是 ：name:lys age:21</span>

<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sq<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> pathname <span class="token punctuation">}</span><span class="token operator">=</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>pathname<span class="token operator">==</span><span class="token string">&quot;/logo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// POST请求</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token operator">==</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            request<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置为utf8编码，data事件获取的内容是Buffer</span>
            request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">//通过监听data事件，获取body里面的数据</span>
                <span class="token keyword">let</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span>age<span class="token punctuation">}</span><span class="token operator">=</span><span class="token punctuation">(</span>sq<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使用 querystring 模块 对字符串链接进行拆分为对象</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lys</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 21</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'欢迎'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:8081/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="_1-4-3-headers处理"><a href="#_1-4-3-headers处理" class="header-anchor">#</a> 1.4.3：headers处理</h4> <ul><li>在request对象的header中也包含很多有用的信息，客户端会默认传递过来一些信息</li></ul> <p><img src="C:%5CUsers%5C111%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210731144835031.png" alt="image-20210731144835031"></p> <ul><li>content-type是这次请求携带的数据的类型：
<ul><li>application/json表示是一个json类型；</li> <li>text/plain表示是文本类型；</li> <li>application/xml表示是xml类型;</li> <li>multipart/form-data表示是上传文件;</li></ul></li> <li>content-length：文件的大小和长度</li> <li>keep-alive：
<ul><li>http是基于TCP协议的，但是通常在进行一次请求和响应结束后会立刻中断；</li> <li>在http1.0中，如果想要继续保持连接：
<ul><li>浏览器需要在请求头中添加 connection: keep-alive；</li> <li>服务器需要在响应头中添加 connection:keey-alive；</li> <li>当客户端再次放请求时，就会使用同一个连接，直接一方中断连接；</li></ul></li> <li>在http1.1中，所有连接默认是 connection: keep-alive的；
<ul><li>不同的Web服务器会有不同的保持 keep-alive的时间；</li> <li>Node中默认是5s中；</li></ul></li></ul></li> <li>accept-encoding：告知服务器，客户端支持的文件压缩格式，比如js文件可以使用gzip编码，对应 .gz文件</li> <li>accept：告知服务器，客户端可接受文件的格式类型；</li> <li>user-agent：客户端相关的信息；</li></ul> <h3 id="_1-5-response对象"><a href="#_1-5-response对象" class="header-anchor">#</a> 1.5：response对象</h3> <ul><li><p>如果我们希望给客户端相应的结果数据，可以通过两个方式</p> <ul><li><p>Write方法：这种方式是直接写出数据，但是并没有关闭流；</p></li> <li><p>end方法：这种方式是写出最后的数据，并且写出后关闭流</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;123123&quot;</span><span class="token punctuation">)</span>
response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>如果我们没有调用end和close，客户端将会一直等待结果；</p> <ul><li>所以客户端在发送网络请求时，都会设置超时时间。</li></ul></li></ul></li></ul> <h4 id="_1-5-1-返回状态码"><a href="#_1-5-1-返回状态码" class="header-anchor">#</a> 1.5.1：返回状态码</h4> <ul><li><p>Http状态码（Http Status Code）是用来表示Http相应状态的数据代码。</p> <ul><li><p>Http状态码非常多，可以根据不同的情况，给客户端返回不同的状态码。</p></li> <li><p>常见的状态码是下面这些</p> <p><img src="C:%5CUsers%5C111%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210731155106311.png" alt="image-20210731155106311"></p></li> <li><p>设置状态码常见的两种方式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>response<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li></ul> <h4 id="_1-5-2-响应头文件"><a href="#_1-5-2-响应头文件" class="header-anchor">#</a> 1.5.2：响应头文件</h4> <ul><li>返回头部信息，主要有两种方式；
<ul><li>response.setHeader ：一次写入一个头部信息；</li> <li>response.writeHead：同时写入header和status;</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_1-6-http请求"><a href="#_1-6-http请求" class="header-anchor">#</a> 1.6：http请求</h3> <ul><li><p>axios库可以在浏览器中使用，也可以在Node中使用</p> <ul><li>在浏览器中，axios使用的是封装xhr；</li> <li>在Node中，使用的是http内置模块；</li></ul></li> <li><p>get请求</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8081/&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>post请求</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hostname</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span><span class="token number">8081</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul> <h2 id="十-node中使用mysql"><a href="#十-node中使用mysql" class="header-anchor">#</a> 十：Node中使用MySQL</h2> <ul><li>前面我们所有的操作都是在GUI工具中，<font color="orange">通过执行SQL语句来获取结果的</font>，那真实开发中肯定是通过代码来完成所有的操作的。</li> <li>那么如何可以在<font color="orange">Node的代码中执行SQL语句</font>来，这里我们可以借助于两个库：
<ul><li><font color="orange">mysql</font>：最早的Node连接MySQL的数据库驱动；</li> <li><font color="orange">mysql2</font>：在mysql的基础之上，进行了很多的优化、改进；</li></ul></li> <li>目前相对来说，我<font color="orange">更偏向于使用mysql2，mysql2兼容mysql的AP</font>I，并且提供了一些附加功能
<ul><li>更快/更好的性能；</li> <li><font color="orange">Prepared Statement（预编译语句）</font>：
<ul><li><font color="orange">提高性能</font>：将创建的语句模块发送给MySQL，然后MySQL编译（<font color="orange">解析、优化、转换</font>）语句模块，并且存储它但是不执行，之后我们在真正执行时会给?<font color="orange">提供实际的参数才会执行；就算多次执行，也只会编译一次，所以性能是更高的</font>；</li> <li><font color="orange">防止SQL注入</font>：之后传入的值不会像模块引擎那样就编译，那么一些SQL注入的内容不会被执行；<font color="orange">or 1 = 1不会被执行</font>；</li> <li>支持<font color="orange">Promise</font>，所以我们<font color="orange">可以使用async和await</font>语法</li></ul></li></ul></li></ul> <h3 id="_1-1-使用msql2"><a href="#_1-1-使用msql2" class="header-anchor">#</a> 1.1：使用msql2</h3> <ul><li><p>安装mysql2</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>npm install mysql2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>mysql2使用过程如下</p> <ul><li>第一步：创建连接(通过createConnection)，并且获取连接对象；</li> <li>第二步：执行SQL语句即可(通过query)；</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>const mysql<span class="token operator">=</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'mysql2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const connection<span class="token operator">=</span> mysql<span class="token punctuation">.</span>createConnection<span class="token punctuation">(</span>{
    host:<span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token keyword">database</span>:<span class="token string">'coderhub'</span><span class="token punctuation">,</span>
    <span class="token keyword">user</span>:<span class="token string">'root'</span><span class="token punctuation">,</span>
    password:<span class="token string">'coderlys88'</span>
}<span class="token punctuation">)</span>
connection<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'select * from courses;'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>results<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span>{
    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
  TextRow <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> '英语'<span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  TextRow <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> '语文'<span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">666</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  TextRow <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">:</span> '数学'<span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">888</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  TextRow <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">:</span> '历史'<span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">80</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  TextRow <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> name<span class="token operator">:</span> '物理'<span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  TextRow <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> name<span class="token operator">:</span> '生物'<span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">99</span> <span class="token punctuation">}</span>  
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <h3 id="_1-2-prepared-statement"><a href="#_1-2-prepared-statement" class="header-anchor">#</a> 1.2：Prepared Statement</h3> <ul><li><p><strong>Prepared Statement(预编译语句)</strong></p> <ul><li><p><font color="orange">提高性能</font>：将创建的语句<font color="orange">模块发送给MySQL</font> ，然后<font color="orange">MySQL编译（解析、优化、转换）语句模块</font>，并且存储它<font color="orange">但是不执行</font>，之后我们在真正执行时会给？提供实际的参数才会执行，<font color="orange">就算多次执行，也只会编译一次，所以性能是更高的</font>；</p></li> <li><p><font color="orange">防止SQL注入</font>：之后传入的值不会像模块引擎那样就编译，那么一<font color="orange">些SQL注入的内容不会被执行；or 1 = 1 不会被执行</font>；</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>const statement<span class="token operator">=</span><span class="token string">'select * from products where price&gt;=? and score&gt;=?'</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token keyword">execute</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6000</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>results<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span>{
    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li> <li><p>强调：如果再次执行该语句，它将会从LRU （Least Recently Used） Cache中获取获取，省略了编译statement 的时间来提高性能。</p></li></ul> <h3 id="_1-3-connection-pools"><a href="#_1-3-connection-pools" class="header-anchor">#</a> 1.3：Connection Pools</h3> <ul><li><p>前面我们<font color="orange">是创建了一个连接（connection）</font>，但是如果我们<font color="orange">有多个请求的话，该连接很有可能正在被占用</font>，那么我们是否需要每次一个请求都去创建一个新的连接呢？</p> <ul><li>事实上，mysql2给我们<font color="orange">提供了连接池</font>（connection pools）；</li> <li>连接池可以在<font color="orange">需要的时候自动创建连接</font>，并且<font color="orange">创建的连接不会被销毁，会放到连接池中，后续可以继续使用</font>；</li> <li>创建的连接<font color="orange">不会被销毁</font>，会<font color="orange">放到连接池中</font>，<font color="orange">后续可以继续使用</font></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> mysql<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> connection<span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span><span class="token string">'coderhub'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span><span class="token string">'coderlys88'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">connectionLimit</span><span class="token operator">:</span><span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> statement<span class="token operator">=</span><span class="token string">'select * from products where price&gt;=? and score&gt;=?'</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6000</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>results</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul> <h3 id="_1-4-promise方式"><a href="#_1-4-promise方式" class="header-anchor">#</a> 1.4：Promise方式</h3> <ul><li><p>目前在JavaScript开发中我们更习惯Promise和await、async的方式，mysql2同样是支持的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> mysql<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> createPool<span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span><span class="token string">'coderhub'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span><span class="token string">'coderlys88'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">connectionLimit</span><span class="token operator">:</span><span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> statement<span class="token operator">=</span><span class="token string">'select * from products where price&gt;=? and score&gt;=?'</span><span class="token punctuation">;</span>

createPool<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6000</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>results<span class="token punctuation">,</span>fields<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ul> <h3 id="_1-5-认识orm"><a href="#_1-5-认识orm" class="header-anchor">#</a> 1.5：认识ORM</h3> <ul><li><p>对象关系映射（英语：Object Relational Mapping，简称ORM，或O/RM，或O/R mapping），是一种程序设计的方案：</p> <ul><li>从效果上来讲，它提供了一个可在编程语言中，使用虚似对象数据库的效果；</li> <li>比如在java开发中经常使用的ORM包括：Hibernate、MyBatis;</li></ul></li> <li><p>Node当中的ORM我们通常使用的是sequelize；</p> <ul><li>Sequelize是用于Postgres，MySQL，MariaDB，SQLite和Microsoft SQL Server的基于Node.js 的 ORM；</li> <li>它支持非常多的功能；</li></ul></li> <li><p>如果我们希望将Sequelize和MySQL一起使用，那么我们需要先安装两个东西：</p> <ul><li><p>mysql2：sequelize在操作mysql时使用的是mysql2；</p></li> <li><p>sequelize：使用它来让对象映射到表中；</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install sequelize mysql2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li></ul> <h2 id="十一-登录凭证"><a href="#十一-登录凭证" class="header-anchor">#</a> 十一：登录凭证</h2> <ul><li>web开发中，我们使用<font color="orange">最多的协议是http</font>，但是<font color="orange">http是一个无状态的协议</font>。
<ul><li>无状态的协议？什么叫做无状态协议呢？</li></ul></li> <li>举个例子：
<ul><li>我们登录了一个网站 www.coderhub.com（当然这个网站不存在，是我要开发一个的）;</li> <li>登录的时候我们需要输入用户名和密码：比如用户名coderwhy，密码：Coderwhy666.;</li> <li>登录成功之后，我们要以coderwhy的身份去访问其他的数据和资源，还是通过http请求去访问。
<ul><li>coderhub的服务器会问：你谁呀？</li> <li>coderwhy说：我是coderwhy呀，刚刚登录过呀；</li> <li>coderhub：怎么证明你刚刚登录过呀？</li> <li>coderwhy说：这。。。，http没有告诉你吗？</li> <li>coderhub：http的每次请求对我来说都是一个单独的请求，和之前请求过什么没有关系。</li></ul></li> <li>看到了吧？这就是http的无状态，<font color="orange">也就是服务器不知道你上一步做了什么，我们必须得有一个办法可以证明我们登录过</font>。</li></ul></li></ul> <h3 id="_1-1-认识cookie"><a href="#_1-1-认识cookie" class="header-anchor">#</a> 1.1：认识cookie</h3> <ul><li>Cookie（复数形态Cookies），又称为“小甜饼”。类型为“<font color="orange">小型文本文件</font>，某些网站<font color="orange">为了辨别用户身份而存储在用户本地终端（Client Side）上的数据。</font> <ul><li>浏览器会在特定的情况下携带上cookie来发送请求，我们可以通过cookie来获取一些信息；</li></ul></li> <li>Cookie总是保存在客户端中，按在客户端中的存储位置，Cookie可以分为<font color="orange">内存Cookie</font>和<font color="orange">硬盘Cookie</font>。
<ul><li><font color="cornflowerblue">内存Cookie由浏览器维护，保存在内存中，浏览器关闭时Cookie就会消失，其存在时间是短暂的</font>；</li> <li><font color="cornflowerblue">硬盘Cookie保存在硬盘中，有一个过期时间，用户手动清理或者过期时间到时，才会被清理</font>；</li></ul></li> <li>如果判断一个cookie是内存cookie还是硬盘cookie呢？
<ul><li><font color="orange">没有设置过期时间，默认情况下cookie是内存cookie</font>，在关闭浏览器时会自动删除；</li> <li><font color="orange">有设置过期时间</font>，并且过期时间不为0或者负数的cookie，<font color="orange">是硬盘cookie</font>，需要手动或者到期时，才会删除；</li></ul></li></ul> <h4 id="_1-1-1-常见的属性"><a href="#_1-1-1-常见的属性" class="header-anchor">#</a> 1.1.1：常见的属性</h4> <ul><li><strong>cookie的生命周期：</strong> <ul><li><font color="orange">默认情况下的cookie是内存cookie</font>，也称之为会话cookie，<font color="orange">也就是在浏览器关闭时会自动被删除</font>；</li> <li>我们可以通过设置expires或者max-age来设置过期的时间；
<ul><li><font color="orange">expires：</font>设置的是Date.toUTCString()，设置格式是;expires=date-in-GMTString-format；</li> <li><font color="orange">max-age：</font>设置过期的秒钟，;max-age=max-age-in-seconds (例如一年为60<em>60</em>24*365)；</li></ul></li></ul></li> <li>cookie的作用域：（<font color="orange">允许cookie发送给哪些URL</font>）
<ul><li>Domain：指定哪些主机可以接受cookie
<ul><li>如果不指定，那么<font color="orange">默认是 origin</font>，不包括子域名。</li> <li>如果<font color="orange">指定Domain</font>，则包含子域名。例如，如果设置 Domain=mozilla.org，则 Cookie 也包含在子域名中（如developer.mozilla.org）。</li></ul></li> <li>path：指定主机下哪些路径可以接受cookie
<ul><li>例如，设置 Path=/docs，则以下地址都会匹配：
<ul><li>/docs</li> <li>/docs/web/</li> <li>/docs/web/http</li></ul></li></ul></li></ul></li></ul> <h4 id="_1-1-2-客户端设置cookie"><a href="#_1-1-2-客户端设置cookie" class="header-anchor">#</a> 1.1.2：客户端设置cookie</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// js直接设置和获取cookie</span>

	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span>

<span class="token comment">// 这个cookie会在会话关闭被删除掉</span>

	document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token string">&quot;name=coderwhy&quot;</span>
	document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token string">&quot;age=18&quot;</span>

<span class="token comment">// 设置cookie，同时设置过期时间 (默认单位是秒钟)</span>

	document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token string">&quot;name=coderwhy; max-age=10 &quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_1-1-3-服务器设置cookie"><a href="#_1-1-3-服务器设置cookie" class="header-anchor">#</a> 1.1.3：服务器设置cookie</h4> <ul><li><p>koa中默认支持直接操作cookie</p> <ul><li>setCookie请求中设置cookie</li> <li>getCookie请求中获取cookie</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> koaRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koaRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/setCookie'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'zhangSan'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token literal-property property">maxAge</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">*</span><span class="token number">10000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">'cookies'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getCookie'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> ler <span class="token operator">=</span> ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body<span class="token operator">=</span>ler
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器已启动'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li></ul> <h3 id="_1-2-session-基于cookie实现机制"><a href="#_1-2-session-基于cookie实现机制" class="header-anchor">#</a> 1.2：session 基于cookie实现机制</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> koaRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> koaSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-session'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koaRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">koaSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span><span class="token string">&quot;sessionId&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">maxAge</span><span class="token operator">:</span><span class="token number">500</span><span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">signed</span><span class="token operator">:</span><span class="token boolean">true</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span>app<span class="token punctuation">)</span>

app<span class="token punctuation">.</span>keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'aaaa'</span><span class="token punctuation">]</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/setSession'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> id<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> name<span class="token operator">=</span><span class="token string">'zhangSan'</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">,</span>name<span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">&quot;123&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getSession'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span>name<span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body<span class="token operator">=</span>name<span class="token operator">+</span><span class="token string">&quot;$&quot;</span><span class="token operator">+</span>id
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器已启动'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="_1-2-1-cookie和session的方式的缺点"><a href="#_1-2-1-cookie和session的方式的缺点" class="header-anchor">#</a> 1.2.1：cookie和session的方式的缺点：</h4> <ul><li>Cookie会被附加在每个HTTP请求中，所以无形中添加了流量（事实上某些是不需要）；</li> <li>Cookie是明文传递的，所以存在安全性的问题；</li> <li>Cookie的大小限制是4KB，对于复制的需求来说是不够的；</li> <li>对于浏览器外的其他客户端（比如IOS,Android）必须手动的设置cookie和session；</li> <li>对于分布式系统和服务器集群中如何可以保证其他系统也可以正确的解析session</li></ul> <h3 id="_1-3-认识token"><a href="#_1-3-认识token" class="header-anchor">#</a> 1.3：认识toKen</h3> <ul><li>在目前的前后端分离的开发过程中，使用token来进行身份验证的是最多的情况；</li> <li>token可以翻译为令牌；</li> <li>也就是在验证了用户账号和密码正确的情况，给用户颁发一个令牌；</li> <li>这个令牌作为后续用户访问一些接口或者资源的凭证；</li> <li>我们可以根据这个凭证来判断用户是否有权限来访问；</li></ul> <p>所以token的使用应该分成两个重要步骤：</p> <ul><li>生成token：登录的时候，颁发token；</li> <li>验证token：访问某些资源或者接口时，验证token；</li></ul> <h4 id="_1-3-1-jwt实现token机制"><a href="#_1-3-1-jwt实现token机制" class="header-anchor">#</a> 1.3.1：JWT实现Token机制</h4> <p><strong>JWT生成的Token由三部分组成</strong></p> <p><strong><font color="orange">header</font></strong></p> <ul><li>alg：采用的加密算法，默认是HMAC SHA256 (HS256)，采用同一个密钥进行加密和解密；</li> <li>typ：JWT，固定值，通常都写成JWT即可；</li> <li>会通过base64Url算法进行编码；</li></ul> <p><strong><font color="orange">payload</font></strong></p> <ul><li>携带的数据，比如我们可以将用户的id和name放到payload中；</li> <li>默认也会携带iat (issued at) ，令牌的签发时间；</li> <li>我们也可以设置过期时间：exp (expiration time)；</li> <li>会通过base64Url算法进行编码</li></ul> <p><strong><font color="orange">signature</font></strong></p> <ul><li>设置一个secreKey，通过将前两个结果合并后进行HMACSHA256的算法；</li> <li>HMACSHA256(base64Url(header)+.+base64Url(payload), secretKey);</li> <li>但是如果secretKey暴露是一件非常危险的事情，因为之后就可以模似颁发toKen，也可以解密toKen</li></ul> <h4 id="_1-3-2-token的使用"><a href="#_1-3-2-token的使用" class="header-anchor">#</a> 1.3.2：Token的使用</h4> <ul><li>当然，在真实开发中，我们可以直接使用一个库来完成：<font color="orange">jsonwebtoken</font></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> koa <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> koaRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koaRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> user<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;lys&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> token<span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span><span class="token string">&quot;abc123&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token literal-property property">expiresIn</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">*</span><span class="token number">60</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body<span class="token operator">=</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/dome'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> authorization <span class="token operator">=</span> ctx<span class="token punctuation">.</span>header<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span>
    <span class="token keyword">const</span> tk <span class="token operator">=</span> authorization<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>tk<span class="token punctuation">,</span><span class="token string">'abc123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> result
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;服务器已启动&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="_1-3-3-非对称加密"><a href="#_1-3-3-非对称加密" class="header-anchor">#</a> 1.3.3：非对称加密</h4> <ul><li><p>前面我们说过，<font color="orange">HS256加密算法一单密钥暴露就是非常危险的事情</font>：</p> <ul><li>比如在<font color="orange">分布式系统</font>中，<font color="orange">每一个子系统都需要获取到密钥</font>；</li> <li>那么拿到这个<font color="orange">密钥后</font>这个子系统既可以<font color="orange">发布另外</font>，也<font color="orange">可以验证令牌</font>；</li> <li>但是对于一些<font color="orange">资源服务器</font>来说，它们只需要有<font color="orange">验证令牌的能力</font>就可以了；</li></ul></li> <li><p>这个时候我们可以使用<font color="orange">非对称加密，RS256</font>：</p> <ul><li>私钥（<font color="orange">private key</font>）：用于<font color="orange">发布令牌</font>；</li> <li>公钥（<font color="orange">public key</font>）：用于<font color="orange">验证令牌</font>；</li></ul></li> <li><p>我们可以使用<font color="orange">openssl</font>来<font color="orange">生成一对私钥和公钥</font>：</p> <ul><li>Mac直接使用terminal终端即可；</li> <li>Windows默认的cmd终端是不能直接使用的，建议直接使用git bash终端；</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>openssl
&gt; genrsa -out private.key 1024
&gt; rsa -in private.key -pubout -out public.key
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> privateKey <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./sharekeys/private.key'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> publicKey <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'./sharekeys/public.key'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
     privateKey<span class="token punctuation">,</span>
     publicKey
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>privateKey<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../app/config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">LoginController</span><span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> user<span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>privateKey<span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token literal-property property">algorithm</span><span class="token operator">:</span><span class="token string">&quot;RS256&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">expiresIn</span><span class="token operator">:</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">=</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">,</span>token<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">async</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>body<span class="token operator">=</span>ctx<span class="token punctuation">.</span>user
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">LoginController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> errorType <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../constants/error-types.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>publicKey<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../app/config'</span><span class="token punctuation">)</span> 

<span class="token keyword">const</span> <span class="token function-variable function">verifyAuth</span><span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> authorization <span class="token operator">=</span> ctx<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> authorization<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> ret <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span>publicKey<span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token literal-property property">algorithms</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'RS256'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span>user<span class="token operator">=</span>ret    
        <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> err<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Error</span> <span class="token punctuation">(</span>errorType<span class="token punctuation">.</span><span class="token constant">UNAUTHORIZATION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span>err<span class="token punctuation">,</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    verifyLogin<span class="token punctuation">,</span>
    verifyAuth
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>loginRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/text'</span><span class="token punctuation">,</span>verifyAuth<span class="token punctuation">,</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#一-邂逅node-js" class="sidebar-link reco-side-一-邂逅node-js" data-v-cb1513f6>一：邂逅Node.js</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-javascript引擎" class="sidebar-link reco-side-_1-1-javascript引擎" data-v-cb1513f6>1.1：JavaScript引擎</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-v8引擎" class="sidebar-link reco-side-_1-2-v8引擎" data-v-cb1513f6>1.2：V8引擎</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-3-浏览器和node-js架构区别" class="sidebar-link reco-side-_1-3-浏览器和node-js架构区别" data-v-cb1513f6>1.3：浏览器和Node.js架构区别</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-4-node的安装" class="sidebar-link reco-side-_1-4-node的安装" data-v-cb1513f6>1.4：Node的安装</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-5-javascript代码执行" class="sidebar-link reco-side-_1-5-javascript代码执行" data-v-cb1513f6>1.5：JavaScript代码执行</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-6-node程序传递参数" class="sidebar-link reco-side-_1-6-node程序传递参数" data-v-cb1513f6>1.6：Node程序传递参数</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-7-为什么叫argv" class="sidebar-link reco-side-_1-7-为什么叫argv" data-v-cb1513f6>1.7：为什么叫argv</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-8-node的输出" class="sidebar-link reco-side-_1-8-node的输出" data-v-cb1513f6>1.8：Node的输出</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-9-特殊的全局对象" class="sidebar-link reco-side-_1-9-特殊的全局对象" data-v-cb1513f6>1.9：特殊的全局对象</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_2-0-global对象" class="sidebar-link reco-side-_2-0-global对象" data-v-cb1513f6>2.0：global对象</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_2-1-global和window区别" class="sidebar-link reco-side-_2-1-global和window区别" data-v-cb1513f6>2.1：global和window区别</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_2-2-process简介" class="sidebar-link reco-side-_2-2-process简介" data-v-cb1513f6>2.2：process简介</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#二-javascript模块化" class="sidebar-link reco-side-二-javascript模块化" data-v-cb1513f6>二：JavaScript模块化</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-什么是模块化" class="sidebar-link reco-side-_1-1-什么是模块化" data-v-cb1513f6>1.1：什么是模块化？</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-没有模块化带来的问题" class="sidebar-link reco-side-_1-2-没有模块化带来的问题" data-v-cb1513f6>1.2：没有模块化带来的问题</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-3-commonjs和node" class="sidebar-link reco-side-_1-3-commonjs和node" data-v-cb1513f6>1.3：CommonJS和Node</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-4-exports导出" class="sidebar-link reco-side-_1-4-exports导出" data-v-cb1513f6>1.4：exports导出</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-5-module-exports导出" class="sidebar-link reco-side-_1-5-module-exports导出" data-v-cb1513f6>1.5：module.exports导出</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-6-module-exports和exports的关系和区别" class="sidebar-link reco-side-_1-6-module-exports和exports的关系和区别" data-v-cb1513f6>1.6：module.exports和exports的关系和区别</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-7-require导入" class="sidebar-link reco-side-_1-7-require导入" data-v-cb1513f6>1.7：require导入</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-8-认识并使用-es-module" class="sidebar-link reco-side-_1-8-认识并使用-es-module" data-v-cb1513f6>1.8：认识并使用 ES Module</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#三-node常用内置模块" class="sidebar-link reco-side-三-node常用内置模块" data-v-cb1513f6>三：Node常用内置模块</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-内置模块-path" class="sidebar-link reco-side-_1-1-内置模块-path" data-v-cb1513f6>1.1：内置模块 path</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-内置模块-fs" class="sidebar-link reco-side-_1-2-内置模块-fs" data-v-cb1513f6>1.2：内置模块 fs</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#四-包管理工具" class="sidebar-link reco-side-四-包管理工具" data-v-cb1513f6>四：包管理工具</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-包管理工具npm" class="sidebar-link reco-side-_1-1-包管理工具npm" data-v-cb1513f6>1.1：包管理工具npm</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-配置文件-package-json" class="sidebar-link reco-side-_1-2-配置文件-package-json" data-v-cb1513f6>1.2：配置文件 package.json</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-3-npm-install-命令" class="sidebar-link reco-side-_1-3-npm-install-命令" data-v-cb1513f6>1.3：npm install 命令</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-4-package-lock-json" class="sidebar-link reco-side-_1-4-package-lock-json" data-v-cb1513f6>1.4：package-lock.json</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#五-开发脚手架工具" class="sidebar-link reco-side-五-开发脚手架工具" data-v-cb1513f6>五：开发脚手架工具</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-自定义终端命令过程" class="sidebar-link reco-side-_1-1-自定义终端命令过程" data-v-cb1513f6>1.1：自定义终端命令过程</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-version-help-option开发" class="sidebar-link reco-side-_1-2-version-help-option开发" data-v-cb1513f6>1.2：version-help-option开发</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#六-buffer的使用" class="sidebar-link reco-side-六-buffer的使用" data-v-cb1513f6>六：Buffer的使用</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-数据的二进制" class="sidebar-link reco-side-_1-1-数据的二进制" data-v-cb1513f6>1.1：数据的二进制</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-buffer和二进制" class="sidebar-link reco-side-_1-2-buffer和二进制" data-v-cb1513f6>1.2：Buffer和二进制</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-3-buffer的创建" class="sidebar-link reco-side-_1-3-buffer的创建" data-v-cb1513f6>1.3：Buffer的创建</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-4-buffer的创建过程" class="sidebar-link reco-side-_1-4-buffer的创建过程" data-v-cb1513f6>1.4：Buffer的创建过程</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-5-buffer对文件的读取" class="sidebar-link reco-side-_1-5-buffer对文件的读取" data-v-cb1513f6>1.5：Buffer对文件的读取</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-6-buffer对图片的读取和写入" class="sidebar-link reco-side-_1-6-buffer对图片的读取和写入" data-v-cb1513f6>1.6：Buffer对图片的读取和写入</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-7-使用sharp的库" class="sidebar-link reco-side-_1-7-使用sharp的库" data-v-cb1513f6>1.7：使用Sharp的库</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#七-事件循环和异步io" class="sidebar-link reco-side-七-事件循环和异步io" data-v-cb1513f6>七：事件循环和异步IO</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-进程和线程" class="sidebar-link reco-side-_1-1-进程和线程" data-v-cb1513f6>1.1：进程和线程</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-多进程多线程开发" class="sidebar-link reco-side-_1-2-多进程多线程开发" data-v-cb1513f6>1.2：多进程多线程开发</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-3-浏览器和javascript" class="sidebar-link reco-side-_1-3-浏览器和javascript" data-v-cb1513f6>1.3：浏览器和JavaScript</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-4-浏览器的事件循环" class="sidebar-link reco-side-_1-4-浏览器的事件循环" data-v-cb1513f6>1.4：浏览器的事件循环</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-5-宏任务和微任务" class="sidebar-link reco-side-_1-5-宏任务和微任务" data-v-cb1513f6>1.5：宏任务和微任务</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-6-node的架构分析" class="sidebar-link reco-side-_1-6-node的架构分析" data-v-cb1513f6>1.6：Node的架构分析</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-7-阻塞io和非阻塞io" class="sidebar-link reco-side-_1-7-阻塞io和非阻塞io" data-v-cb1513f6>1.7：阻塞IO和非阻塞IO</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-8-node事件循环的阶段" class="sidebar-link reco-side-_1-8-node事件循环的阶段" data-v-cb1513f6>1.8：Node事件循环的阶段</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-9-node的微任务和宏任务" class="sidebar-link reco-side-_1-9-node的微任务和宏任务" data-v-cb1513f6>1.9：Node的微任务和宏任务</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#八-认识stream" class="sidebar-link reco-side-八-认识stream" data-v-cb1513f6>八：认识Stream</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-文件读写的stream" class="sidebar-link reco-side-_1-1-文件读写的stream" data-v-cb1513f6>1.1：文件读写的Stream</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#九-http-模块" class="sidebar-link reco-side-九-http-模块" data-v-cb1513f6>九：Http 模块</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-web服务器" class="sidebar-link reco-side-_1-1-web服务器" data-v-cb1513f6>1.1：web服务器</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-创建服务器" class="sidebar-link reco-side-_1-2-创建服务器" data-v-cb1513f6>1.2：创建服务器</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-3-监听主机和端口号" class="sidebar-link reco-side-_1-3-监听主机和端口号" data-v-cb1513f6>1.3：监听主机和端口号</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-4-request对象" class="sidebar-link reco-side-_1-4-request对象" data-v-cb1513f6>1.4：request对象</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-5-response对象" class="sidebar-link reco-side-_1-5-response对象" data-v-cb1513f6>1.5：response对象</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-6-http请求" class="sidebar-link reco-side-_1-6-http请求" data-v-cb1513f6>1.6：http请求</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#十-node中使用mysql" class="sidebar-link reco-side-十-node中使用mysql" data-v-cb1513f6>十：Node中使用MySQL</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-使用msql2" class="sidebar-link reco-side-_1-1-使用msql2" data-v-cb1513f6>1.1：使用msql2</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-prepared-statement" class="sidebar-link reco-side-_1-2-prepared-statement" data-v-cb1513f6>1.2：Prepared Statement</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-3-connection-pools" class="sidebar-link reco-side-_1-3-connection-pools" data-v-cb1513f6>1.3：Connection Pools</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-4-promise方式" class="sidebar-link reco-side-_1-4-promise方式" data-v-cb1513f6>1.4：Promise方式</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-5-认识orm" class="sidebar-link reco-side-_1-5-认识orm" data-v-cb1513f6>1.5：认识ORM</a></li><li class="level-2" data-v-cb1513f6><a href="/./blogs/backEnd/node/#十一-登录凭证" class="sidebar-link reco-side-十一-登录凭证" data-v-cb1513f6>十一：登录凭证</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-1-认识cookie" class="sidebar-link reco-side-_1-1-认识cookie" data-v-cb1513f6>1.1：认识cookie</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-2-session-基于cookie实现机制" class="sidebar-link reco-side-_1-2-session-基于cookie实现机制" data-v-cb1513f6>1.2：session 基于cookie实现机制</a></li><li class="level-3" data-v-cb1513f6><a href="/./blogs/backEnd/node/#_1-3-认识token" class="sidebar-link reco-side-_1-3-认识token" data-v-cb1513f6>1.3：认识toKen</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="./assets/js/app.f65de421.js" defer></script><script src="./assets/js/3.4298b55b.js" defer></script><script src="./assets/js/1.610d1c6f.js" defer></script><script src="./assets/js/12.36b93efc.js" defer></script>
  </body>
</html>
